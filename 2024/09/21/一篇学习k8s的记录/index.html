<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ä¸€ç¯‡å­¦ä¹ k8sçš„è®°å½• | ç‹å­é˜³ã®ä¸»é¡µ</title><meta name="author" content="ç‹å­é˜³"><meta name="copyright" content="ç‹å­é˜³"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="åŠ æ·±å¯¹k8sçš„ç†è§£">
<meta property="og:type" content="article">
<meta property="og:title" content="ä¸€ç¯‡å­¦ä¹ k8sçš„è®°å½•">
<meta property="og:url" content="http://example.com/2024/09/21/%E4%B8%80%E7%AF%87%E5%AD%A6%E4%B9%A0k8s%E7%9A%84%E8%AE%B0%E5%BD%95/index.html">
<meta property="og:site_name" content="ç‹å­é˜³ã®ä¸»é¡µ">
<meta property="og:description" content="åŠ æ·±å¯¹k8sçš„ç†è§£">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.gitmirror.com/ByteQuestor/picture/main/kubernetes/k8s.jpg">
<meta property="article:published_time" content="2024-09-21T08:29:14.000Z">
<meta property="article:modified_time" content="2024-11-13T03:55:15.966Z">
<meta property="article:author" content="ç‹å­é˜³">
<meta property="article:tag" content="k8s">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.gitmirror.com/ByteQuestor/picture/main/kubernetes/k8s.jpg"><link rel="shortcut icon" href="https://raw.gitmirror.com//ByteQuestor/picture/main/myhead.png"><link rel="canonical" href="http://example.com/2024/09/21/%E4%B8%80%E7%AF%87%E5%AD%A6%E4%B9%A0k8s%E7%9A%84%E8%AE%B0%E5%BD%95/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.0.0-b2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        if (name && globalFn[key][name]) return
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ä¸€ç¯‡å­¦ä¹ k8sçš„è®°å½•',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-11-13 03:55:15'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://raw.gitmirror.com//ByteQuestor/picture/main/myhead.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">24</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹æƒ…é“¾æ¥é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://raw.gitmirror.com/ByteQuestor/picture/main/kubernetes/k8s.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ç‹å­é˜³ã®ä¸»é¡µ</span></a><a class="nav-page-title" href="/"><span class="site-name">ä¸€ç¯‡å­¦ä¹ k8sçš„è®°å½•</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹æƒ…é“¾æ¥é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">ä¸€ç¯‡å­¦ä¹ k8sçš„è®°å½•</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2024-09-21T08:29:14.000Z" title="å‘è¡¨äº 2024-09-21 08:29:14">2024-09-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2024-11-13T03:55:15.966Z" title="æ›´æ–°äº 2024-11-13 03:55:15">2024-11-13</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>åŸæ–‡é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://k8s.easydoc.net/docs/dRiQjyTY/28366845/6GiNOzyZ/9EX8Cp45">ğŸ“š Kubernetesï¼ˆK8Sï¼‰ç®€ä»‹ - K8S æ•™ç¨‹ - æ˜“æ–‡æ¡£ (easydoc.net)</a></p>
<h1 id="k8sç®€ä»‹"><a href="#k8sç®€ä»‹" class="headerlink" title="k8sç®€ä»‹"></a>k8sç®€ä»‹</h1><h2 id="éƒ¨ç½²åº”ç”¨çš„æ–¹æ¡ˆ"><a href="#éƒ¨ç½²åº”ç”¨çš„æ–¹æ¡ˆ" class="headerlink" title="éƒ¨ç½²åº”ç”¨çš„æ–¹æ¡ˆ"></a>éƒ¨ç½²åº”ç”¨çš„æ–¹æ¡ˆ</h2><ul>
<li>ä¼ ç»Ÿéƒ¨ç½²<br>ç›´æ¥åœ¨ç‰©ç†æœºä¸Šéƒ¨ç½²ï¼Œæœºå™¨èµ„æºåˆ†é…ä¸å¥½æ§åˆ¶ï¼Œå¦‚æœå‡ºç°bugï¼Œå¯èƒ½æœºå™¨çš„å¤§éƒ¨åˆ†èµ„æºè¢«æŸä¸ªåº”ç”¨å ç”¨ï¼Œå¯¼è‡´å…¶ä»–åº”ç”¨æ— æ³•æ­£å¸¸è¿è¡Œï¼Œæ— æ³•åšåˆ°åº”ç”¨éš”ç¦»</li>
<li>è™šæ‹Ÿæœºéƒ¨ç½²<br>åœ¨ç‰©ç†æœºä¸Šè¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºï¼Œæ¯ä¸ªè™šæ‹Ÿæœºéƒ½æ˜¯å®Œæ•´ç‹¬ç«‹çš„ç³»ç»Ÿï¼Œæ€§èƒ½æŸè€—å¤§</li>
<li>å®¹å™¨éƒ¨ç½²<br>æ‰€æœ‰å®¹å™¨å…±äº«ä¸»æœºï¼Œè½»é‡çº§çš„è™šæ‹Ÿæœºï¼Œæ€§èƒ½æŸè€—å°ï¼Œèµ„æºéš”ç¦»ï¼ŒCPUå’Œå†…å­˜å¯æŒ‰éœ€åˆ†é…</li>
</ul>
<h2 id="ä»€ä¹ˆæ—¶å€™éœ€è¦k8s"><a href="#ä»€ä¹ˆæ—¶å€™éœ€è¦k8s" class="headerlink" title="ä»€ä¹ˆæ—¶å€™éœ€è¦k8s"></a>ä»€ä¹ˆæ—¶å€™éœ€è¦k8s</h2><p>å¦‚æœåº”ç”¨åªæ˜¯è·‘åœ¨ä¸€å°æœºå™¨ï¼Œ<code>docker + docker-compose</code></p>
<p>å¦‚æœåº”ç”¨è·‘åœ¨3,4å°æœºå™¨ä¸Šï¼Œæ¯å°æœºå™¨å•ç‹¬é…ç½®è¿è¡Œç¯å¢ƒ + è´Ÿè½½å‡è¡¡å…¶ï¼›</p>
<p>å½“åº”ç”¨è®¿é—®æ•°ä¸æ–­å¢åŠ ï¼Œæœºå™¨é€æ¸å¢åŠ åˆ°<strong>å‡ åä¸Šåƒå°</strong>ï¼Œè¿›è¡Œ<strong>åŠ æœºå™¨ã€è½¯ä»¶æ›´æ–°ã€ç‰ˆæœ¬å›æ»š</strong>éƒ½ä¼šå¾ˆéº»çƒ¦</p>
<p>k8så°±æ˜¯å¯ä»¥ä¸€ä¸ªå‘½ä»¤æå®šè¿™äº›éº»çƒ¦äº‹ï¼Œä¸åœæœºçš„ç°åº¦æ›´æ–°ï¼Œç¡®ä¿é«˜å¯ç”¨ã€é«˜æ€§èƒ½ã€é«˜æ‰©å±•</p>
<h2 id="k8sé›†ç¾¤æ¶æ„"><a href="#k8sé›†ç¾¤æ¶æ„" class="headerlink" title="k8sé›†ç¾¤æ¶æ„"></a>k8sé›†ç¾¤æ¶æ„</h2><p>æœ€å°‘è¦ä¸¤å°æœºå™¨</p>
<ul>
<li>ä¸»æœºç‚¹(master)<br><strong>æ§åˆ¶å¹³å°ï¼Œä¸éœ€è¦å¾ˆé«˜æ€§èƒ½</strong>ï¼Œä¸è·‘ä»»åŠ¡ï¼Œé€šå¸¸ä¸€ä¸ªå°±å¯ä»¥äº†ï¼Œä¹Ÿå¯ä»¥å¤šå¼€æé«˜é›†ç¾¤å¯ç”¨åº¦</li>
<li>å·¥ä½œèŠ‚ç‚¹(worker)<br>å¯ä»¥è¯´è™šæ‹Ÿæœºæˆ–ç‰©ç†æœºï¼Œä»»åŠ¡éƒ½åœ¨è¿™é‡Œè·‘ï¼Œæœºå™¨è¦æ€§èƒ½å¥½ï¼Œé€šå¸¸æœ‰å¤šä¸ªï¼Œæ¯ä¸ªå·¥ä½œèŠ‚ç‚¹éƒ½ç”±ä¸»èŠ‚ç‚¹ç®¡ç†<br>ã€Šæ’å…¥æ‰‹ç»˜å›¾ã€‹</li>
</ul>
<h2 id="é‡è¦æ¦‚å¿µPodï¼ˆè±†èšï¼‰"><a href="#é‡è¦æ¦‚å¿µPodï¼ˆè±†èšï¼‰" class="headerlink" title="é‡è¦æ¦‚å¿µPodï¼ˆè±†èšï¼‰"></a>é‡è¦æ¦‚å¿µPodï¼ˆè±†èšï¼‰</h2><p>k8sè°ƒåº¦ï¼Œç®¡ç†çš„æœ€å°å•ä½ï¼Œä¸»èŠ‚ç‚¹è´Ÿè´£è€ƒé‡è´Ÿè½½è‡ªåŠ¨è°ƒåº¦Podåˆ°å“ªä¸ª**èŠ‚ç‚¹(worker)**è¿è¡Œ</p>
<ul>
<li>ä¸€ä¸ª<strong>Podå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨</strong></li>
<li>æ¯ä¸ªPodéƒ½æœ‰è‡ªå·±çš„è™šæ‹ŸIP</li>
<li>ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹æœ‰å¤šä¸ªPod</li>
</ul>
<blockquote>
<p>æ€»ç»“ï¼š&#96;&#96;worker<code>åŒ…å«</code>pod<code>ï¼Œ</code>pod&#96;åŒ…å«å®¹å™¨</p>
</blockquote>
<h2 id="k8sç»„ä»¶"><a href="#k8sç»„ä»¶" class="headerlink" title="k8sç»„ä»¶"></a>k8sç»„ä»¶</h2><ul>
<li><code>kube-apiserver</code>APIæœåŠ¡å™¨ï¼Œå…¬å¼€äº†<code>kubernetes API</code></li>
<li><code>etcd</code>é”®å€¼æ•°æ®åº“ï¼Œå¯ä»¥ä½œä¸ºä¿å­˜k8sæ‰€æœ‰é›†ç¾¤æ•°æ®çš„åå°æ•°æ®åº“</li>
<li><code>kube-scheduler</code>è°ƒåº¦<code>Pod</code>åˆ°å“ªä¸ªèŠ‚ç‚¹è¿è¡Œ</li>
<li><code>kube-controller</code>é›†ç¾¤æ§åˆ¶å™¨</li>
<li><code>cloud-controller</code>ä¸äº‘æœåŠ¡å•†äº¤äº’</li>
</ul>
<h1 id="å®‰è£…k8sé›†ç¾¤"><a href="#å®‰è£…k8sé›†ç¾¤" class="headerlink" title="å®‰è£…k8sé›†ç¾¤"></a>å®‰è£…k8sé›†ç¾¤</h1><h2 id="ä¸»æœºåæ˜ å°„"><a href="#ä¸»æœºåæ˜ å°„" class="headerlink" title="ä¸»æœºåæ˜ å°„"></a>ä¸»æœºåæ˜ å°„</h2><h2 id="å…³é—­SElinux-é˜²æŠ¤å¢™"><a href="#å…³é—­SElinux-é˜²æŠ¤å¢™" class="headerlink" title="å…³é—­SElinux &amp; é˜²æŠ¤å¢™"></a>å…³é—­SElinux &amp; é˜²æŠ¤å¢™</h2><h2 id="æ·»åŠ å®‰è£…æº"><a href="#æ·»åŠ å®‰è£…æº" class="headerlink" title="æ·»åŠ å®‰è£…æº"></a>æ·»åŠ å®‰è£…æº</h2><p>å»ºè®®å®‰è£…ç‰ˆæœ¬ä¸è¶…è¿‡<code>1.24</code>ï¼Œå› ä¸º<code>1.24</code>ä»¥åé»˜è®¤ä¸æ”¯æŒ<code>docker</code>äº†ï¼Œå¾—ç”¨<code>podman</code>æˆ–å•ç‹¬å®‰è£…æ’ä»¶</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Centosçš„</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ·»åŠ  k8s å®‰è£…æº</span></span><br><span class="line">cat &lt;&lt;EOF &gt; kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line">mv kubernetes.repo /etc/yum.repos.d/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ·»åŠ  Docker å®‰è£…æº</span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<h2 id="å®‰è£…æ‰€éœ€ç»„ä»¶ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰"><a href="#å®‰è£…æ‰€éœ€ç»„ä»¶ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰" class="headerlink" title="å®‰è£…æ‰€éœ€ç»„ä»¶ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰"></a>å®‰è£…æ‰€éœ€ç»„ä»¶ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y kubelet-1.22.4 kubectl-1.22.4 kubeadm-1.22.4 docker-ce</span><br></pre></td></tr></table></figure>

<h2 id="å¯åŠ¨-kubeletã€dockerï¼Œå¹¶è®¾ç½®å¼€æœºå¯åŠ¨ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰"><a href="#å¯åŠ¨-kubeletã€dockerï¼Œå¹¶è®¾ç½®å¼€æœºå¯åŠ¨ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰" class="headerlink" title="å¯åŠ¨ kubeletã€dockerï¼Œå¹¶è®¾ç½®å¼€æœºå¯åŠ¨ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰"></a>å¯åŠ¨ kubeletã€dockerï¼Œå¹¶è®¾ç½®å¼€æœºå¯åŠ¨ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable kubelet</span><br><span class="line">systemctl start kubelet</span><br><span class="line">systemctl enable docker</span><br><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

<h2 id="ä¿®æ”¹-docker-é…ç½®ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰"><a href="#ä¿®æ”¹-docker-é…ç½®ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰" class="headerlink" title="ä¿®æ”¹ docker é…ç½®ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰"></a>ä¿®æ”¹ docker é…ç½®ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kubernetes å®˜æ–¹æ¨è docker ç­‰ä½¿ç”¨ systemd ä½œä¸º cgroupdriverï¼Œå¦åˆ™ kubelet å¯åŠ¨ä¸äº†</span></span><br><span class="line">cat &lt;&lt;EOF &gt; daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://ud6340vz.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">mv daemon.json /etc/docker/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é‡å¯ç”Ÿæ•ˆ</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<h2 id="ç”¨-kubeadm-åˆå§‹åŒ–é›†ç¾¤ï¼ˆä»…åœ¨ä¸»èŠ‚ç‚¹è·‘ï¼‰"><a href="#ç”¨-kubeadm-åˆå§‹åŒ–é›†ç¾¤ï¼ˆä»…åœ¨ä¸»èŠ‚ç‚¹è·‘ï¼‰" class="headerlink" title="ç”¨ kubeadm åˆå§‹åŒ–é›†ç¾¤ï¼ˆä»…åœ¨ä¸»èŠ‚ç‚¹è·‘ï¼‰"></a>ç”¨ <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/">kubeadm</a> åˆå§‹åŒ–é›†ç¾¤ï¼ˆä»…åœ¨ä¸»èŠ‚ç‚¹è·‘ï¼‰</h2><p><code>token</code>æ˜¯è¿™æ¡<code>init</code>å‘½ä»¤ç”Ÿäº§çš„ï¼Œåœ¨<code>log</code>é‡Œæœ‰</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆå§‹åŒ–é›†ç¾¤æ§åˆ¶å° Control plane</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¤±è´¥äº†å¯ä»¥ç”¨ kubeadm reset é‡ç½®</span></span><br><span class="line">kubeadm init --image-repository=registry.aliyuncs.com/google_containers</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®°å¾—æŠŠ kubeadm <span class="built_in">join</span> xxx ä¿å­˜èµ·æ¥</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¿˜è®°äº†é‡æ–°è·å–ï¼škubeadm token create --print-join-command</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¤åˆ¶æˆæƒæ–‡ä»¶ï¼Œä»¥ä¾¿ kubectl å¯ä»¥æœ‰æƒé™è®¿é—®é›†ç¾¤</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœä½ å…¶ä»–èŠ‚ç‚¹éœ€è¦è®¿é—®é›†ç¾¤ï¼Œéœ€è¦ä»ä¸»èŠ‚ç‚¹å¤åˆ¶è¿™ä¸ªæ–‡ä»¶è¿‡å»å…¶ä»–èŠ‚ç‚¹</span></span><br><span class="line">mkdir -p $HOME/.kube</span><br><span class="line">cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœ¨å…¶ä»–æœºå™¨ä¸Šåˆ›å»º ~/.kube/config æ–‡ä»¶ä¹Ÿèƒ½é€šè¿‡ kubectl è®¿é—®åˆ°é›†ç¾¤</span></span><br></pre></td></tr></table></figure>



<h2 id="æŠŠå·¥ä½œèŠ‚ç‚¹åŠ å…¥é›†ç¾¤ï¼ˆåªåœ¨å·¥ä½œèŠ‚ç‚¹è·‘ï¼‰"><a href="#æŠŠå·¥ä½œèŠ‚ç‚¹åŠ å…¥é›†ç¾¤ï¼ˆåªåœ¨å·¥ä½œèŠ‚ç‚¹è·‘ï¼‰" class="headerlink" title="æŠŠå·¥ä½œèŠ‚ç‚¹åŠ å…¥é›†ç¾¤ï¼ˆåªåœ¨å·¥ä½œèŠ‚ç‚¹è·‘ï¼‰"></a>æŠŠå·¥ä½œèŠ‚ç‚¹åŠ å…¥é›†ç¾¤ï¼ˆåªåœ¨å·¥ä½œèŠ‚ç‚¹è·‘ï¼‰</h2><p>ä¸‹é¢è¿™æ¡å‘½ä»¤ï¼Œåœ¨masterå®‰è£…æˆåŠŸåä¼šæä¾›ï¼Œåªéœ€è¦ç›´æ¥å¤åˆ¶å³å¯</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join 172.16.32.10:6443 --token xxx --discovery-token-ca-cert-hash xxx</span><br></pre></td></tr></table></figure>



<h2 id="å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œå¦åˆ™-node-æ˜¯-NotReady-çŠ¶æ€ï¼ˆä¸»èŠ‚ç‚¹è·‘ï¼‰"><a href="#å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œå¦åˆ™-node-æ˜¯-NotReady-çŠ¶æ€ï¼ˆä¸»èŠ‚ç‚¹è·‘ï¼‰" class="headerlink" title="å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œå¦åˆ™ node æ˜¯ NotReady çŠ¶æ€ï¼ˆä¸»èŠ‚ç‚¹è·‘ï¼‰"></a>å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œå¦åˆ™ node æ˜¯ NotReady çŠ¶æ€ï¼ˆä¸»èŠ‚ç‚¹è·‘ï¼‰</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¾ˆæœ‰å¯èƒ½å›½å†…ç½‘ç»œè®¿é—®ä¸åˆ°è¿™ä¸ªèµ„æºï¼Œä½ å¯ä»¥ç½‘ä¸Šæ‰¾æ‰¾å›½å†…çš„æºå®‰è£… flannel</span></span><br><span class="line">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¦‚æœä¸Šé¢çš„æ’ä»¶å®‰è£…å¤±è´¥ï¼Œå¯ä»¥é€‰ç”¨ Weaveï¼Œä¸‹é¢çš„å‘½ä»¤äºŒé€‰ä¸€å°±å¯ä»¥äº†ã€‚</span></span><br><span class="line">kubectl apply -f https://github.com/weaveworks/weave/releases/download/v2.8.1/weave-daemonset-k8s.yaml</span><br><span class="line">kubectl apply -f http://static.corecore.cn/weave.v2.8.1.yaml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ›´å¤šå…¶ä»–ç½‘è·¯æ’ä»¶æŸ¥çœ‹ä¸‹é¢ä»‹ç»ï¼Œè‡ªè¡Œç½‘ä¸Šæ‰¾ yaml å®‰è£…</span></span><br><span class="line">https://blog.csdn.net/ChaITSimpleLove/article/details/117809007</span><br></pre></td></tr></table></figure>



<hr>
<h1 id="éƒ¨ç½²åº”ç”¨åˆ°é›†ç¾¤ä¸­"><a href="#éƒ¨ç½²åº”ç”¨åˆ°é›†ç¾¤ä¸­" class="headerlink" title="éƒ¨ç½²åº”ç”¨åˆ°é›†ç¾¤ä¸­"></a>éƒ¨ç½²åº”ç”¨åˆ°é›†ç¾¤ä¸­</h1><h2 id="ç®€å•éƒ¨ç½²"><a href="#ç®€å•éƒ¨ç½²" class="headerlink" title="ç®€å•éƒ¨ç½²"></a>ç®€å•éƒ¨ç½²</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run testApp --image=$é•œåƒ</span><br></pre></td></tr></table></figure>

<h2 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h2><p>å°†YAMLè½¬ä¸ºJSONå¯ä»¥æ›´æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œæ¯ä¸ªç¼©è¿›éƒ½æ˜¯ä¸€ä¸ªå¤§æ‹¬å·ï¼Œä»–ä»¬å°±æ˜¯ä¸€ç»„èµ„æº</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-pod</span>	<span class="comment"># podçš„åå­—</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment"># å®šä¹‰å®¹å™¨ï¼Œå¯ä»¥å¤šä¸ª</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-k8s</span> <span class="comment"># å®¹å™¨åå­—ï¼Œå®¹å™¨æ˜¯è¿è¡Œåœ¨podé‡Œé¢çš„</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">ccr.ccs.tencentyun.com/k8s-tutorial/test-k8s:v1</span> <span class="comment"># é•œåƒ</span></span><br></pre></td></tr></table></figure>

<p>éƒ¨ç½²</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f $YAMLæ–‡ä»¶</span><br></pre></td></tr></table></figure>

<h2 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h2><p>åŸæ–‡å‚è€ƒå›¾<br><img src="https://cos.easydoc.net/46901064/files/kwpt8p8o.png" alt="å‚è€ƒå›¾"></p>
<p>æ¯æ¬¡éƒ¨ç½²ä¸€ä¸ªPodå¾ˆä¸æ–¹ä¾¿</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span>	<span class="comment"># è¿™ä¸ªå¯ä»¥ç«‹å³ä¸ºç›´æ¥å»ºç«‹ä¸€ä¸ªç»„ï¼Œå°±æ˜¯è¿™ä¸ªç»„å°†éƒ¨ç½²å¤šå°‘ä¸ªèµ„æº</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="comment"># éƒ¨ç½²åå­—</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-k8s</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span>	<span class="comment"># è¿è¡Œçš„podæ•°é‡</span></span><br><span class="line">  <span class="comment"># ç”¨æ¥æŸ¥æ‰¾å…³è”çš„ Podï¼Œæ‰€æœ‰æ ‡ç­¾éƒ½åŒ¹é…æ‰è¡Œ</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">test-k8s</span></span><br><span class="line">  <span class="comment"># å®šä¹‰ Pod ç›¸å…³æ•°æ®</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">test-k8s</span>	 <span class="comment"># æ³¨æ„è¿™ä¸ªæ ‡ç­¾ï¼Œä¸€å®šè¦è·Ÿselector é‡Œçš„æ ‡ç­¾å¯¹åº”ä¸Š</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># å®šä¹‰å®¹å™¨ï¼Œå¯ä»¥å¤šä¸ª</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-k8s</span> <span class="comment"># å®¹å™¨åå­—ï¼Œè¿™ä¸ªä¸éœ€è¦è·Ÿå…¶ä»–çš„ä¸€æ ·ï¼Œå› ä¸ºè¿™æ˜¯podå†…éƒ¨çš„å®¹å™¨</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">ccr.ccs.tencentyun.com/k8s-tutorial/test-k8s:v1</span> <span class="comment"># é•œåƒ</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šPodéƒ¨ç½²æˆ‘ä»¬èµ·ä»€ä¹ˆåå­—å°±æ˜¯ä»€ä¹ˆåå­—ï¼ŒDeploymentéƒ¨ç½²ï¼Œä¼šåœ¨æˆ‘ä»¬èµ·çš„åå­—ååŠ ä¸€æ®µéšæœºå­—ç¬¦ä»¥é¿å…é‡å¤</p>
<p><code>Pod</code>éƒ¨ç½²å’Œ<code>Deployment</code>éƒ¨ç½²çš„ç»“æœéƒ½æ˜¯ä¸€æ ·çš„</p>
<p><strong>å”¯ä¸€çš„åŒºåˆ«æ˜¯</strong>ï¼Œ<code>Deployment</code>éƒ¨ç½²çš„å°†ä¼šæœ‰æ­¤<code>yaml</code>æ–‡ä»¶ç»Ÿä¸€ç®¡ç†ï¼Œå¦‚éœ€å˜åŒ–ï¼Œåªéœ€è¦æ›´æ”¹<code>yaml</code>æ–‡ä»¶å†æ¬¡<code>apply</code>å³å¯</p>
<p>è¿™æ ·åˆ›å»ºçš„èµ„æºï¼Œå¯ä»¥ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿™æ˜¯æ‰€æœ‰çš„podï¼ŒåŒ…æ‹¬ç›´æ¥åˆ›å»ºçš„ pod å’Œ deploymentéƒ¨ç½²</span> </span><br><span class="line">kubectl get pod</span><br><span class="line">kubectl get pod -o wide</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¹Ÿå¯ä»¥ç›´æ¥çœ‹Deployment(éƒ¨ç½²)</span></span><br><span class="line">kubectl get deployment # è¿™æ ·å°±çœ‹åˆ°äº†æˆ‘ä»¬æ‰€æœ‰çš„DeploymentåŠå…¶podæ¦‚è§ˆ</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹podè¯¦ç»†çŠ¶æ€</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe $podname</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹podæ—¥å¿—</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs/$podname</span><br><span class="line">kubectl logs/$podname -f	# æŒç»­æŸ¥çœ‹</span><br></pre></td></tr></table></figure>

<p>è¿›å…¥pod</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec -it $podname</span><br><span class="line">kubectl exec -it $podname -c $å®¹å™¨åå­—</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤Deployment</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete deployment $DeploymentName</span><br></pre></td></tr></table></figure>

<p>é‡æ–°Deployment</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout restart deployment $DeploymentName</span><br></pre></td></tr></table></figure>

<p>è·Ÿ<code>docker</code>ä¸€æ ·ï¼Œåªä¸è¿‡æŠŠ<code>docker</code>æ¢æˆäº†<code>kubectl</code></p>
<h2 id="ä¸€äº›å¥½ç”¨çš„å‘½ä»¤"><a href="#ä¸€äº›å¥½ç”¨çš„å‘½ä»¤" class="headerlink" title="ä¸€äº›å¥½ç”¨çš„å‘½ä»¤"></a>ä¸€äº›å¥½ç”¨çš„å‘½ä»¤</h2><h3 id="å‘½ä»¤è¡Œè°ƒåº¦pod"><a href="#å‘½ä»¤è¡Œè°ƒåº¦pod" class="headerlink" title="å‘½ä»¤è¡Œè°ƒåº¦pod"></a>å‘½ä»¤è¡Œè°ƒåº¦pod</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl scale deployment $DeployName --replicas=10</span><br></pre></td></tr></table></figure>

<h3 id="å‘½ä»¤è¡Œç»‘å®šç«¯å£"><a href="#å‘½ä»¤è¡Œç»‘å®šç«¯å£" class="headerlink" title="å‘½ä»¤è¡Œç»‘å®šç«¯å£"></a>å‘½ä»¤è¡Œç»‘å®šç«¯å£</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl port-forward $PodName 8888:80 # å°†Podçš„ 80 ç«¯å£ç»‘å®šåˆ°æœ¬æœº 8888 </span><br></pre></td></tr></table></figure>

<h3 id="å‘½ä»¤è¡Œä¿®æ”¹é•œåƒ"><a href="#å‘½ä»¤è¡Œä¿®æ”¹é•œåƒ" class="headerlink" title="å‘½ä»¤è¡Œä¿®æ”¹é•œåƒ"></a>å‘½ä»¤è¡Œä¿®æ”¹é•œåƒ</h3><p><code>--record</code> è¡¨ç¤ºæŠŠè¿™ä¸ªå‘½ä»¤è®°å½•åˆ°æ“ä½œå†å²ä¸­ï¼Œå°±å¯ä»¥å›é€€äº†</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl set image deployment $DeployMent $ContainerName=$Image --record</span><br></pre></td></tr></table></figure>

<h3 id="å›æ»šæ“ä½œ"><a href="#å›æ»šæ“ä½œ" class="headerlink" title="å›æ»šæ“ä½œ"></a>å›æ»šæ“ä½œ</h3><p>ç›´æ¥ä¿®æ”¹æˆ‘ä»¬çš„é•œåƒï¼Œä¸ä¼šæ€æ‰ä»¥å‰çš„Podï¼Œç›´åˆ°æˆ‘ä»¬çš„æ–°é•œåƒå®Œå…¨éƒ¨ç½²æ‰ä¼šæ€æ‰ä»¥å‰çš„Pod</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æˆ‘ä»¬æœ‰å¤šå°‘å¯ä»¥å›æ»š</span></span><br><span class="line">kubectl rollout history deployment $DeploymentName</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å›é€€ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼ˆæ— éœ€æŒ‡å®šï¼‰,ä¸ä¼šæ€æ‰å½“å‰è¿è¡Œçš„podï¼Œç›´åˆ°æˆ‘ä»¬å›æ»šçš„podå…¨éƒ¨æˆåŠŸè¿è¡Œ</span></span><br><span class="line">kubectl rollout undo deployment $DeploymentName</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å›é€€åï¼ŒåŒæ ·ä¼šå‡ºç°ä¸€ä¸ªç‰ˆæœ¬ï¼Œè¿™æ ·å¦‚æœå†ä¸æŒ‡å®šç‰ˆæœ¬å°±å®¹æ˜“å›æ»šå®¹å™¨å›æ»šåˆ°é”™è¯¯çš„</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å›é€€åˆ° 1 ç‰ˆæœ¬ï¼ˆæ³¨æ„è¿™ä¸ªç‰ˆæœ¬æ˜¯<span class="built_in">history</span>çš„ç‰ˆæœ¬å·ï¼Œè€Œä¸æ˜¯DeploymentNameçš„ç‰ˆæœ¬å·ï¼‰</span></span><br><span class="line">kubectl rollout undo deployment $DeploymentName --to-revision=1</span><br></pre></td></tr></table></figure>

<h3 id="æš‚åœå’Œæ¢å¤ã€å†·é—¨ã€‘"><a href="#æš‚åœå’Œæ¢å¤ã€å†·é—¨ã€‘" class="headerlink" title="æš‚åœå’Œæ¢å¤ã€å†·é—¨ã€‘"></a>æš‚åœå’Œæ¢å¤ã€å†·é—¨ã€‘</h3><p>æ„Ÿè§‰å¤ªå†·é—¨äº†ï¼Œç”¨ä¸ä¸Šï¼Œè®°å½•ä¸€ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æš‚åœè¿è¡Œï¼Œæš‚åœåï¼Œå¯¹ deployment çš„ä¿®æ”¹ä¸ä¼šç«‹åˆ»ç”Ÿæ•ˆï¼Œæ¢å¤åæ‰åº”ç”¨è®¾ç½®</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¯”å¦‚ä¸Šé¢çš„å‘½ä»¤è¡Œä¿®æ”¹é•œåƒï¼Œå…ˆæš‚åœçš„è¯ï¼Œç›´åˆ°æ¢å¤åæ‰ä¼šç”Ÿæ•ˆ</span></span><br><span class="line">kubectl rollout pause deployment $DeploymentName</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœ¨è¿™ä¸¤å¤©å‘½ä»¤ä¸­é—´åšæ“ä½œï¼Œä¸ä¼šç”Ÿæ•ˆï¼Œç­‰æ¢å¤åæ‰ä¼šç”Ÿæ•ˆ</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¢å¤</span></span><br><span class="line">kubectl rollout resume deployment $DeploymentName</span><br></pre></td></tr></table></figure>

<h3 id="è¾“å‡ºåˆ°æ–‡ä»¶ã€å†·é—¨ã€‘"><a href="#è¾“å‡ºåˆ°æ–‡ä»¶ã€å†·é—¨ã€‘" class="headerlink" title="è¾“å‡ºåˆ°æ–‡ä»¶ã€å†·é—¨ã€‘"></a>è¾“å‡ºåˆ°æ–‡ä»¶ã€å†·é—¨ã€‘</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¾“å‡ºåˆ°æ–‡ä»¶</span></span><br><span class="line">kubectl get deployment $DeploymentName -o yaml &gt;&gt; app2.yaml</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤å…¨éƒ¨èµ„æºã€å†·é—¨ã€‘"><a href="#åˆ é™¤å…¨éƒ¨èµ„æºã€å†·é—¨ã€‘" class="headerlink" title="åˆ é™¤å…¨éƒ¨èµ„æºã€å†·é—¨ã€‘"></a>åˆ é™¤å…¨éƒ¨èµ„æºã€å†·é—¨ã€‘</h3><blockquote>
<p><code>æ³¨æ„ï¼š</code>åˆ çš„æ˜¯å…¨éƒ¨èµ„æº</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤å…¨éƒ¨èµ„æº</span></span><br><span class="line">kubectl delete all --all</span><br></pre></td></tr></table></figure>

<h2 id="YAMLæŒ‡å®šæŸä¸ªèŠ‚ç‚¹è¿è¡Œ"><a href="#YAMLæŒ‡å®šæŸä¸ªèŠ‚ç‚¹è¿è¡Œ" class="headerlink" title="YAMLæŒ‡å®šæŸä¸ªèŠ‚ç‚¹è¿è¡Œ"></a>YAMLæŒ‡å®šæŸä¸ªèŠ‚ç‚¹è¿è¡Œ</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">env:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="attr">nodeSelector:</span></span><br><span class="line">    <span class="attr">disktype:</span> <span class="string">ssd</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥æ›´æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œè¿™ä¸ªç¼©è¿›çš„å½±å“èŒƒå›´ï¼Œ</p>
<h2 id="ä¸‹èŠ‚é¢„å‘Š"><a href="#ä¸‹èŠ‚é¢„å‘Š" class="headerlink" title="ä¸‹èŠ‚é¢„å‘Š"></a>ä¸‹èŠ‚é¢„å‘Š</h2><h3 id="å·¥ä½œè´Ÿè½½åˆ†ç±»ã€äº†è§£ã€‘"><a href="#å·¥ä½œè´Ÿè½½åˆ†ç±»ã€äº†è§£ã€‘" class="headerlink" title="å·¥ä½œè´Ÿè½½åˆ†ç±»ã€äº†è§£ã€‘"></a>å·¥ä½œè´Ÿè½½åˆ†ç±»ã€äº†è§£ã€‘</h3><ul>
<li>Deployment<br>é€‚åˆæ— çŠ¶æ€åº”ç”¨ï¼Œæ‰€æœ‰podç­‰ä»·ï¼Œå¯æ›¿ä»£</li>
<li>StatefulSet<br>æœ‰çŠ¶æ€çš„åº”ç”¨ï¼Œé€‚åˆæ•°æ®åº“è¿™ç§ç±»å‹ã€‚</li>
<li>DaemonSet<br>åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè·‘ä¸€ä¸ª Podï¼Œå¯ä»¥ç”¨æ¥åšèŠ‚ç‚¹ç›‘æ§ã€èŠ‚ç‚¹æ—¥å¿—æ”¶é›†ç­‰</li>
<li>Job &amp; CronJob<br>Job ç”¨æ¥è¡¨è¾¾çš„æ˜¯ä¸€æ¬¡æ€§çš„ä»»åŠ¡ï¼Œè€Œ CronJob ä¼šæ ¹æ®å…¶æ—¶é—´è§„åˆ’åå¤è¿è¡Œã€‚</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/workloads/">æ–‡æ¡£</a></p>
<h3 id="ç°å­˜é—®é¢˜"><a href="#ç°å­˜é—®é¢˜" class="headerlink" title="ç°å­˜é—®é¢˜"></a>ç°å­˜é—®é¢˜</h3><ul>
<li>æ¯æ¬¡åªèƒ½è®¿é—®ä¸€ä¸ª podï¼Œæ²¡æœ‰è´Ÿè½½å‡è¡¡è‡ªåŠ¨è½¬å‘åˆ°ä¸åŒ pod</li>
<li>è®¿é—®è¿˜éœ€è¦ç«¯å£è½¬å‘</li>
<li>Pod é‡åˆ›å IP å˜äº†ï¼Œåå­—ä¹Ÿå˜äº†</li>
</ul>
<p>è¿™å°±æ˜¯<code>Service</code>è¦åšçš„äº‹æƒ…</p>
<hr>
<h1 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h1><h2 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h2><ul>
<li><code>Service</code>é€šè¿‡<code>label</code>å…³è”å¯¹åº”çš„<code>Pod</code></li>
<li><code>Service</code>ç”Ÿå‘½å‘¨æœŸä¸é™<code>Pod</code>ç»‘å®š,ä¸ä¼šå› ä¸º<code>Pod</code>é‡åˆ›æ”¹å˜<code>IP</code></li>
<li>æä¾›äº†è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œè‡ªåŠ¨è½¬å‘æµé‡åˆ°ä¸åŒ<code>Pod</code></li>
<li>å¯å¯¹é›†ç¾¤å¤–éƒ¨æä¾›è®¿é—®ç«¯å£</li>
<li>é›†ç¾¤å†…éƒ¨å¯é€šè¿‡æœåŠ¡åå­—è®¿é—®</li>
</ul>
<p><img src="https://cos.easydoc.net/46901064/files/kwpuoh0h.png" alt="serviceç‰¹æ€§"></p>
<h2 id="åˆ›å»ºService"><a href="#åˆ›å»ºService" class="headerlink" title="åˆ›å»ºService"></a>åˆ›å»ºService</h2><p>å…³äºæœåŠ¡ç±»å‹çš„ä»‹ç»</p>
<ul>
<li><p><code>ClusterIP</code>ã€é›†ç¾¤å†…éƒ¨è®¿é—®ã€‘ï¼ˆå¯ä»¥è¿›å…¥åˆ° Pod é‡Œé¢è®¿é—®ï¼‰</p>
</li>
<li><p><code>NodePort</code>ã€èŠ‚ç‚¹å¯è®¿é—®ã€‘ï¼ˆæ¢æˆè¿™ä¸ªå¯æš´éœ²ç«¯å£åè®¿é—®ï¼‰</p>
</li>
<li><p><code>LoadBalancer</code>ã€è´Ÿè½½å‡è¡¡æ¨¡å¼ã€‘ï¼ˆéœ€è¦è´Ÿè½½å‡è¡¡å™¨æ‰èƒ½ä½¿ç”¨ï¼‰</p>
</li>
</ul>
<p>æœåŠ¡çš„é»˜è®¤ç±»å‹æ˜¯<code>ClusterIP</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec -it pod-name -- bash</span><br><span class="line">curl http://test-k8s:8080</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¦åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®ï¼Œå¯ä»¥é€šè¿‡ç«¯å£è½¬å‘å®ç°ï¼ˆåªé€‚åˆä¸´æ—¶æµ‹è¯•ç”¨ï¼‰</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl port-forward service/test-k8s 8888:8080</span><br></pre></td></tr></table></figure>

<p><code>YAML</code>æ–‡ä»¶è§£æ</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-k8s</span> <span class="comment"># æœ¬ Service çš„åå­—</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">test-k8s</span>	 <span class="comment"># æœ¬ Service çš„è¦é›†ç»“å“ªäº› pod</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span>	<span class="comment"># æœåŠ¡ç±»å‹</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8080</span>        <span class="comment"># æœ¬ Service çš„ç«¯å£,å°±æ˜¯å¤–éƒ¨å°†è¦è®¿é—®çš„ç«¯å£</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8080</span>  <span class="comment"># å®¹å™¨ç«¯å£ï¼Œè¢«è½¬å‘è¿‡å»çš„ç«¯å£</span></span><br></pre></td></tr></table></figure>

<p>åº”ç”¨æœåŠ¡</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f service.yaml</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹æœåŠ¡</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get svc</span><br></pre></td></tr></table></figure>

<h3 id="å¯¹å¤–æš´éœ²æœåŠ¡-è´Ÿè½½å‡è¡¡"><a href="#å¯¹å¤–æš´éœ²æœåŠ¡-è´Ÿè½½å‡è¡¡" class="headerlink" title="å¯¹å¤–æš´éœ²æœåŠ¡ &amp; è´Ÿè½½å‡è¡¡"></a>å¯¹å¤–æš´éœ²æœåŠ¡ &amp; è´Ÿè½½å‡è¡¡</h3><p>ä¸Šé¢æ˜¯é€šè¿‡ç«¯å£è½¬å‘çš„æ–¹å¼å¯ä»¥åœ¨å¤–é¢è®¿é—®åˆ°é›†ç¾¤é‡Œçš„æœåŠ¡</p>
<p>å¦‚æœæƒ³è¦ç›´æ¥æŠŠé›†ç¾¤æœåŠ¡æš´éœ²å‡ºæ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>NodePort</code> å’Œ <code>Loadbalancer</code> ç±»å‹çš„ Serviceï¼Œæ­¤æ—¶ä¹Ÿå…·æœ‰äº†è´Ÿè½½å‡è¡¡çš„æ•ˆæœ</p>
<p><code>Loadbalancer</code> ä¹Ÿå¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ï¼Œè¿™éœ€è¦ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨çš„æ”¯æŒï¼Œå› ä¸ºå®ƒéœ€è¦ç”Ÿæˆä¸€ä¸ªæ–°çš„ IP å¯¹å¤–æœåŠ¡ï¼Œå¦åˆ™çŠ¶æ€å°±ä¸€ç›´æ˜¯ penddingï¼Œè¿™ä¸ªå¾ˆå°‘ç”¨äº†ï¼Œåé¢ä¼šæœ‰<strong>æ›´é«˜ç«¯çš„ Ingress æ¥ä»£æ›¿å®ƒ</strong>ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-k8s</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">test-k8s</span></span><br><span class="line">  <span class="comment"># é»˜è®¤ ClusterIP é›†ç¾¤å†…å¯è®¿é—®ï¼ŒNodePort èŠ‚ç‚¹å¯è®¿é—®ï¼ŒLoadBalancer è´Ÿè½½å‡è¡¡æ¨¡å¼ï¼ˆéœ€è¦è´Ÿè½½å‡è¡¡å™¨æ‰å¯ç”¨ï¼‰</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span>	<span class="comment"># éœ€è¦æ–°å¢èŠ‚ç‚¹ç«¯å£</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8080</span>        <span class="comment"># æœ¬ Service çš„ç«¯å£</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8080</span>  <span class="comment"># å®¹å™¨ç«¯å£</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">31000</span>   <span class="comment"># èŠ‚ç‚¹ç«¯å£ï¼ŒèŒƒå›´å›ºå®š 30000 ~ 32767</span></span><br></pre></td></tr></table></figure>

<h2 id="å¤šç«¯å£"><a href="#å¤šç«¯å£" class="headerlink" title="å¤šç«¯å£"></a>å¤šç«¯å£</h2><p>å¯¹äºæŸäº› Serviceï¼Œéœ€è¦å…¬å¼€å¤šä¸ªç«¯å£ã€‚k8så…è®¸ä¸º Service å¯¹è±¡é…ç½®å¤šä¸ªç«¯å£å®šä¹‰ã€‚</p>
<p> ä¸º Service ä½¿ç”¨å¤šä¸ªç«¯å£æ—¶ï¼Œå¿…é¡»ä¸ºæ‰€æœ‰ç«¯å£æä¾›åç§°ï¼Œä»¥ä½¿å®ƒä»¬æ— æ­§ä¹‰</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-k8s</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">test-k8s</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8080</span>        <span class="comment"># æœ¬ Service çš„ç«¯å£</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">test-k8s</span>    <span class="comment"># å¿…é¡»é…ç½®</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8080</span>  <span class="comment"># å®¹å™¨ç«¯å£</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">31000</span>   <span class="comment"># èŠ‚ç‚¹ç«¯å£ï¼ŒèŒƒå›´å›ºå®š 30000 ~ 32767</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8090</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">test-other</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8090</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">32000</span></span><br></pre></td></tr></table></figure>



<h2 id="æœ¬èŠ‚å†…å®¹"><a href="#æœ¬èŠ‚å†…å®¹" class="headerlink" title="æœ¬èŠ‚å†…å®¹"></a>æœ¬èŠ‚å†…å®¹</h2><h3 id="ClusterIP"><a href="#ClusterIP" class="headerlink" title="ClusterIP"></a>ClusterIP</h3><p>é»˜è®¤çš„ï¼Œä»…åœ¨é›†ç¾¤å†…å¯ç”¨</p>
<h3 id="NodePort"><a href="#NodePort" class="headerlink" title="NodePort"></a>NodePort</h3><p>æš´éœ²ç«¯å£åˆ°èŠ‚ç‚¹ï¼Œæä¾›äº†é›†ç¾¤å¤–éƒ¨è®¿é—®çš„å…¥å£<br>ç«¯å£èŒƒå›´å›ºå®š 30000 ~ 32767</p>
<h3 id="LoadBalancer"><a href="#LoadBalancer" class="headerlink" title="LoadBalancer"></a>LoadBalancer</h3><p>éœ€è¦è´Ÿè½½å‡è¡¡å™¨ï¼ˆé€šå¸¸éƒ½éœ€è¦äº‘æœåŠ¡å•†æä¾›ï¼Œè£¸æœºå¯ä»¥å®‰è£… <a target="_blank" rel="noopener" href="https://metallb.universe.tf/">METALLB</a> æµ‹è¯•ï¼‰<br>ä¼šé¢å¤–ç”Ÿæˆä¸€ä¸ª IP å¯¹å¤–æœåŠ¡ï¼Œåç»­ä¼šæœ‰æ›´é«˜çº§çš„<code>Ingress</code><br>K8S æ”¯æŒçš„è´Ÿè½½å‡è¡¡å™¨ï¼š<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/services-networking/service/#internal-load-balancer">è´Ÿè½½å‡è¡¡å™¨</a></p>
<h3 id="Headless"><a href="#Headless" class="headerlink" title="Headless"></a>Headless</h3><p>é€‚åˆæ•°æ®åº“<br>clusterIp è®¾ç½®ä¸º None å°±å˜æˆ Headless äº†ï¼Œä¸ä¼šå†åˆ†é… IPï¼Œåé¢ä¼šå†è®²åˆ°å…·ä½“ç”¨æ³•</p>
<hr>
<h1 id="StatefuSet"><a href="#StatefuSet" class="headerlink" title="StatefuSet"></a>StatefuSet</h1><h2 id="ä»€ä¹ˆæ˜¯StatefuSet"><a href="#ä»€ä¹ˆæ˜¯StatefuSet" class="headerlink" title="ä»€ä¹ˆæ˜¯StatefuSet"></a>ä»€ä¹ˆæ˜¯StatefuSet</h2><p><code>StatefulSet </code>æ˜¯ç”¨æ¥<strong>ç®¡ç†æœ‰çŠ¶æ€çš„åº”ç”¨</strong>ï¼Œä¾‹å¦‚<strong>æ•°æ®åº“</strong>ã€‚</p>
<p>å‰é¢éƒ¨ç½²çš„åº”ç”¨ï¼Œéƒ½æ˜¯<strong>ä¸éœ€è¦å­˜å‚¨æ•°æ®ï¼Œä¸éœ€è¦è®°ä½çŠ¶æ€</strong>çš„ï¼Œå¯ä»¥<strong>éšæ„æ‰©å……å‰¯æœ¬</strong>ï¼Œæ¯ä¸ªå‰¯æœ¬éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå¯æ›¿ä»£çš„ã€‚</p>
<p>è€Œåƒ<strong>æ•°æ®åº“ã€Redis</strong>è¿™ç±»æœ‰çŠ¶æ€çš„ï¼Œä¸èƒ½éšæ„æ‰©å……å‰¯æœ¬çš„ï¼Œ<code>StatefulSet </code>ä¼šå›ºå®šæ¯ä¸ª Pod çš„åå­—ã€‚</p>
<h2 id="StatefulSet-ç‰¹æ€§"><a href="#StatefulSet-ç‰¹æ€§" class="headerlink" title="StatefulSet ç‰¹æ€§"></a>StatefulSet ç‰¹æ€§</h2><ul>
<li>Service çš„ <code>CLUSTER-IP</code> æ˜¯ç©ºçš„ï¼ŒPod åå­—ä¹Ÿæ˜¯å›ºå®šçš„ã€‚</li>
<li>Pod åˆ›å»ºå’Œé”€æ¯æ˜¯æœ‰åºçš„ï¼Œåˆ›å»ºæ˜¯é¡ºåºçš„ï¼Œé”€æ¯æ˜¯é€†åºçš„ã€‚</li>
<li>Pod é‡å»ºä¸ä¼šæ”¹å˜åå­—ï¼Œé™¤äº†IPï¼Œæ‰€ä»¥ä¸è¦ç”¨IPç›´è¿</li>
</ul>
<h2 id="éƒ¨ç½²-StatefulSet-ç±»å‹çš„-Mongodb"><a href="#éƒ¨ç½²-StatefulSet-ç±»å‹çš„-Mongodb" class="headerlink" title="éƒ¨ç½² StatefulSet ç±»å‹çš„ Mongodb"></a>éƒ¨ç½² StatefulSet ç±»å‹çš„ Mongodb</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongodb</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">mongodb</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">mongodb</span>	<span class="comment"># ç”¨æ¥åŒ¹é… POd</span></span><br><span class="line"><span class="comment"># ä¸‹é¢å°±æ˜¯è¦åŒ¹é…çš„podï¼ˆæ˜¯ä¼šèµ·çš„ï¼‰</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">mongodb</span> <span class="comment"># podåå­—</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mongo</span> <span class="comment"># podé‡Œå®¹å™¨çš„åå­—</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">mongo:4.4</span></span><br><span class="line">          <span class="comment"># IfNotPresent ä»…æœ¬åœ°æ²¡æœ‰é•œåƒæ—¶æ‰è¿œç¨‹æ‹‰ï¼ŒAlways æ°¸è¿œéƒ½æ˜¯ä»è¿œç¨‹æ‹‰ï¼ŒNever æ°¸è¿œåªç”¨æœ¬åœ°é•œåƒï¼Œæœ¬åœ°æ²¡æœ‰åˆ™æŠ¥é”™</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># ä¸‹é¢ç”¨ä¸€ä¸ª Service ç»Ÿä¸€ä¸€ä¸ªå…¥å£æ¥è®¿é—®</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongodb</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mongodb</span>	<span class="comment"># è¿™ä¸ªé€‰æ‹©çš„æ˜¯ podçš„æ ‡ç­¾ï¼Œæ‰€æœ‰æ‹¥æœ‰æ­¤æ ‡ç­¾çš„ä¼šè¢« Service ç»Ÿä¸€ç®¡ç†</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="comment"># HeadLess</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span>	<span class="comment"># è¿™æ ·å°±ä¼šé€šè¿‡æœåŠ¡åå­—æ¥è®¿é—®</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">27017</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">27017</span></span><br></pre></td></tr></table></figure>

<p>åˆ›å»º</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f mongo.yaml</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod</span><br><span class="line">kubectl get svc</span><br><span class="line">kubectl get statefulset</span><br></pre></td></tr></table></figure>

<p><code>Endpoint</code>s ä¼šå¤šä¸€ä¸ª <code>hostname</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get endpoints mongodb -o yaml</span><br></pre></td></tr></table></figure>

<p>è®¿é—®æ—¶ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨ <code>Service </code>åå­—è¿æ¥ï¼Œä¼šéšæœºè½¬å‘è¯·æ±‚<br>è¦è¿æ¥æŒ‡å®š Podï¼Œå¯ä»¥è¿™æ ·<code>pod-name.service-name</code>,è¿è¡Œä¸€ä¸ªä¸´æ—¶ Pod è¿æ¥æ•°æ®æµ‹è¯•ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run mongodb-client --rm --tty -i --restart=&#x27;Never&#x27; --image docker.io/bitnami/mongodb:4.4.10-debian-10-r20 --command -- bash</span><br></pre></td></tr></table></figure>

<h3 id="Web-åº”ç”¨è¿æ¥-Mongodb"><a href="#Web-åº”ç”¨è¿æ¥-Mongodb" class="headerlink" title="Web åº”ç”¨è¿æ¥ Mongodb"></a>Web åº”ç”¨è¿æ¥ Mongodb</h3><p>åœ¨é›†ç¾¤å†…éƒ¨ï¼Œå¯ä»¥é€šè¿‡æœåŠ¡åå­—è®¿é—®åˆ°ä¸åŒçš„æœåŠ¡ï¼Œ</p>
<p>è¿›å…¥æˆ‘ä»¬ä¸´æ—¶Podï¼ŒæŒ‡å®šè¿æ¥ç¬¬ä¸€ä¸ª</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo --host mongodb-0.mongodb</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒä¸ªç¬¬ä¸‰ä¸ªéƒ½æ˜¯è¿™æ ·ï¼Œä¹‹æ‰€ä»¥é€šè¿‡åå­—ï¼Œæ˜¯å› ä¸ºIPä¼šå˜ï¼Œä½†æ˜¯åå­—ä¸ä¼šå˜</p>
<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><ul>
<li>èµ·çš„ä¸‰ä¸ªæœåŠ¡å„è‡ªç‹¬ç«‹</li>
<li>é‡å»ºåæ•°æ®ä¸¢å¤±</li>
</ul>
<p>ä¸‹ä¸€èŠ‚<strong>æ•°æ®æŒä¹…åŒ–</strong>è§£å†³</p>
<h1 id="æ•°æ®æŒä¹…åŒ–"><a href="#æ•°æ®æŒä¹…åŒ–" class="headerlink" title="æ•°æ®æŒä¹…åŒ–"></a>æ•°æ®æŒä¹…åŒ–</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>kubernetes é›†ç¾¤ä¸ä¼šå¤„ç†æ•°æ®çš„å­˜å‚¨ï¼Œå¯ä»¥ä¸ºæ•°æ®åº“æŒ‚è½½ä¸€ä¸ªç£ç›˜æ¥ç¡®ä¿æ•°æ®çš„å®‰å…¨ã€‚å¯ä»¥é€‰æ‹©äº‘å­˜å‚¨ã€æœ¬åœ°ç£ç›˜ã€NFSã€‚</p>
<ul>
<li>æœ¬åœ°ç£ç›˜ï¼šå¯ä»¥æŒ‚è½½æŸä¸ªèŠ‚ç‚¹ä¸Šçš„ç›®å½•ï¼Œä½†æ˜¯è¿™éœ€è¦é™å®š pod åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œ</li>
<li>äº‘å­˜å‚¨ï¼šä¸é™å®šèŠ‚ç‚¹ï¼Œä¸å—é›†ç¾¤å½±å“ï¼Œå®‰å…¨ç¨³å®šï¼›éœ€è¦äº‘æœåŠ¡å•†æä¾›ï¼Œè£¸æœºé›†ç¾¤æ˜¯æ²¡æœ‰çš„ã€‚</li>
<li>NFSï¼šä¸é™å®šèŠ‚ç‚¹ï¼Œä¸å—é›†ç¾¤å½±å“</li>
</ul>
<blockquote>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œè¿˜æ˜¯ä¹°äº‘å­˜å‚¨æœ€å¥½</p>
</blockquote>
<h2 id="hostPath-æŒ‚è½½"><a href="#hostPath-æŒ‚è½½" class="headerlink" title="hostPath æŒ‚è½½"></a>hostPath æŒ‚è½½</h2><p>æŠŠèŠ‚ç‚¹ä¸Šçš„ä¸€ä¸ªç›®å½•æŒ‚è½½åˆ° Podï¼Œä½†æ˜¯å·²ç»ä¸æ¨èä½¿ç”¨äº†ã€‚é…ç½®æ–¹å¼ç®€å•ï¼Œä½†æ˜¯<strong>éœ€è¦æ‰‹åŠ¨æŒ‡å®š Pod è·‘åœ¨æŸä¸ªå›ºå®šçš„èŠ‚ç‚¹</strong>ã€‚ä¸é€‚ç”¨äºå¤šèŠ‚ç‚¹é›†ç¾¤ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongodb</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">mongodb</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mongo</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">mongo:4.4</span></span><br><span class="line">          <span class="comment"># IfNotPresent ä»…æœ¬åœ°æ²¡æœ‰é•œåƒæ—¶æ‰è¿œç¨‹æ‹‰ï¼ŒAlways æ°¸è¿œéƒ½æ˜¯ä»è¿œç¨‹æ‹‰ï¼ŒNever æ°¸è¿œåªç”¨æœ¬åœ°é•œåƒï¼Œæœ¬åœ°æ²¡æœ‰åˆ™æŠ¥é”™</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="comment"># ---------------- ä»¥ä¸‹æ˜¯æ–°åŠ å…¥çš„éƒ¨åˆ† ---------------------- #        </span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/data/db</span> <span class="comment"># å®¹å™¨é‡Œé¢çš„æŒ‚è½½è·¯å¾„</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">mongo-data</span>    <span class="comment"># å·åå­—ï¼Œå¿…é¡»è·Ÿä¸‹é¢å®šä¹‰çš„åå­—ä¸€è‡´</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mongo-data</span>              <span class="comment"># å·åå­—</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/data/mongo-data</span>      <span class="comment"># èŠ‚ç‚¹ä¸Šçš„è·¯å¾„</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span>     <span class="comment"># æŒ‡å‘ä¸€ä¸ªç›®å½•ï¼Œä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»º</span></span><br></pre></td></tr></table></figure>

<h2 id="å­˜å‚¨ä»‹ç»"><a href="#å­˜å‚¨ä»‹ç»" class="headerlink" title="å­˜å‚¨ä»‹ç»"></a>å­˜å‚¨ä»‹ç»</h2><p>ä¸‹å›¾æœ‰ä¸€ä¸ªé”™è¯¯</p>
<p><img src="https://cos.easydoc.net/46901064/files/kwrmidne.png" alt="å­˜å‚¨æŠ½è±¡"></p>
<h3 id="Persistent-Volume-Claim-PVC"><a href="#Persistent-Volume-Claim-PVC" class="headerlink" title="Persistent Volume Claim (PVC)"></a>Persistent Volume Claim (PVC)</h3><p>å¯¹å­˜å‚¨éœ€æ±‚çš„ä¸€ä¸ªç”³æ˜ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªç”³è¯·å•ï¼Œç³»ç»Ÿæ ¹æ®è¿™ä¸ªç”³è¯·å•å»æ‰¾ä¸€ä¸ªåˆé€‚çš„ PVï¼Œè¿˜å¯ä»¥æ ¹æ® PVC è‡ªåŠ¨åˆ›å»º PVã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongodata</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span> [<span class="string">&quot;ReadWriteOnce&quot;</span>]</span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">&quot;local-storage&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">2Gi</span></span><br></pre></td></tr></table></figure>

<h3 id="Persistent-Volume-PV"><a href="#Persistent-Volume-PV" class="headerlink" title="Persistent Volume (PV)"></a>Persistent Volume (PV)</h3><p>æè¿°å·çš„å…·ä½“ä¿¡æ¯ï¼Œä¾‹å¦‚ç£ç›˜å¤§å°ï¼Œ<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/storage/persistent-volumes/#access-modes">è®¿é—®æ¨¡å¼</a>ã€‚<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/storage/persistent-volumes/">æ–‡æ¡£</a>ï¼Œ<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/storage/persistent-volumes/#types-of-persistent-volumes">ç±»å‹</a>ï¼Œ<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/storage/volumes/#local">Local ç¤ºä¾‹</a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongodata</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">2Gi</span></span><br><span class="line">  <span class="attr">volumeMode:</span> <span class="string">Filesystem</span>  <span class="comment"># Filesystemï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰ Blockï¼ˆå—ï¼‰</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span>       <span class="comment"># å·å¯ä»¥è¢«ä¸€ä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span> <span class="string">Delete</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">local-storage</span></span><br><span class="line">  <span class="attr">local:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/root/data</span></span><br><span class="line">  <span class="attr">nodeAffinity:</span></span><br><span class="line">    <span class="attr">required:</span></span><br><span class="line">      <span class="comment"># é€šè¿‡ hostname é™å®šåœ¨æŸä¸ªèŠ‚ç‚¹åˆ›å»ºå­˜å‚¨å·</span></span><br><span class="line">      <span class="attr">nodeSelectorTerms:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">matchExpressions:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">kubernetes.io/hostname</span></span><br><span class="line">              <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">              <span class="attr">values:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">node2</span></span><br></pre></td></tr></table></figure>

<h3 id="Storage-Class-SC"><a href="#Storage-Class-SC" class="headerlink" title="Storage Class (SC)"></a>Storage Class (SC)</h3><p>å°†å­˜å‚¨å·åˆ’åˆ†ä¸ºä¸åŒçš„ç§ç±»ï¼Œä¾‹å¦‚ï¼šSSDï¼Œæ™®é€šç£ç›˜ï¼Œæœ¬åœ°ç£ç›˜ï¼ŒæŒ‰éœ€ä½¿ç”¨ã€‚<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/storage/storage-classes/">æ–‡æ¡£</a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">slow</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">kubernetes.io/aws-ebs</span></span><br><span class="line"><span class="attr">parameters:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">io1</span></span><br><span class="line">  <span class="attr">iopsPerGB:</span> <span class="string">&quot;10&quot;</span></span><br><span class="line">  <span class="attr">fsType:</span> <span class="string">ext4</span></span><br></pre></td></tr></table></figure>

<h2 id="æœ¬åœ°å­˜å‚¨"><a href="#æœ¬åœ°å­˜å‚¨" class="headerlink" title="æœ¬åœ°å­˜å‚¨"></a>æœ¬åœ°å­˜å‚¨</h2><p>æ‰€éœ€æ–‡ä»¶æ±‡æ€»</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongodb</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">mongodb</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">mongo:5.0</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">mongo</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/data/db</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">mongo-data</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mongo-data</span></span><br><span class="line">          <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">             <span class="attr">claimName:</span> <span class="string">mongodata</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongodb</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">27017</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">27017</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">local-storage</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">kubernetes.io/no-provisioner</span></span><br><span class="line"><span class="attr">volumeBindingMode:</span> <span class="string">WaitForFirstConsumer</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongodata</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">2Gi</span></span><br><span class="line">  <span class="attr">volumeMode:</span> <span class="string">Filesystem</span>  <span class="comment"># Filesystemï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰ Blockï¼ˆå—ï¼‰</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span>       <span class="comment"># å·å¯ä»¥è¢«ä¸€ä¸ªèŠ‚ç‚¹ä»¥è¯»å†™æ–¹å¼æŒ‚è½½</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span> <span class="string">Delete</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">local-storage</span></span><br><span class="line">  <span class="attr">local:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/root/data</span></span><br><span class="line">  <span class="attr">nodeAffinity:</span></span><br><span class="line">    <span class="attr">required:</span></span><br><span class="line">      <span class="comment"># é€šè¿‡ hostname é™å®šåœ¨æŸä¸ªèŠ‚ç‚¹åˆ›å»ºå­˜å‚¨å·</span></span><br><span class="line">      <span class="attr">nodeSelectorTerms:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">matchExpressions:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">kubernetes.io/hostname</span></span><br><span class="line">              <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">              <span class="attr">values:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">node2</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongodata</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span> [<span class="string">&quot;ReadWriteOnce&quot;</span>]</span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">&quot;local-storage&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">2Gi</span></span><br></pre></td></tr></table></figure>



<h2 id="é—®é¢˜-1"><a href="#é—®é¢˜-1" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><ul>
<li>å½“å‰æ•°æ®åº“çš„è¿æ¥åœ°å€æ˜¯å†™æ­»åœ¨ä»£ç é‡Œçš„ï¼Œå¦å¤–è¿˜æœ‰æ•°æ®åº“çš„å¯†ç éœ€è¦é…ç½®ã€‚</li>
</ul>
<p>æœ¬åœ°å¤ªéº»çƒ¦äº†ï¼Œè¿˜æ˜¯ä¹°äº‘å­˜å‚¨</p>
<h1 id="ConfigMap-Secret"><a href="#ConfigMap-Secret" class="headerlink" title="ConfigMap &amp; Secret"></a>ConfigMap &amp; Secret</h1><h2 id="ConfigMap"><a href="#ConfigMap" class="headerlink" title="ConfigMap"></a>ConfigMap</h2><p>æ¯”å¦‚æ•°æ®åº“è¿æ¥åœ°å€ï¼Œè¿™ç§å¯èƒ½ä¼šæ ¹æ®ç¯å¢ƒå˜åŒ–çš„ï¼Œæˆ‘ä»¬ä¸åº”è¯¥å†™æ­»åœ¨ä»£ç é‡Œ</p>
<p><code>configmap.yaml</code>ç¤ºä¾‹</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongo-config</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">mongoHost:</span> <span class="string">mongodb-0.mongodb</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åº”ç”¨</span></span><br><span class="line">kubectl apply -f configmap.yaml</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹</span></span><br><span class="line">kubectl get configmap mongo-config -o yaml</span><br></pre></td></tr></table></figure>



<h2 id="Secret"><a href="#Secret" class="headerlink" title="Secret"></a>Secret</h2><p>ä¸€äº›é‡è¦æ•°æ®ï¼Œä¾‹å¦‚å¯†ç ã€<code>TOKEN</code>ï¼Œå¯ä»¥æ”¾åˆ°<code>Secret </code>ä¸­</p>
<p><code>secret.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongo-secret</span></span><br><span class="line"><span class="comment"># Opaque ç”¨æˆ·å®šä¹‰çš„ä»»æ„æ•°æ®ï¼Œæ›´å¤šç±»å‹ä»‹ç» https://kubernetes.io/zh/docs/concepts/configuration/secret/#secret-types</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="comment"># æ•°æ®è¦ base64ã€‚https://tools.fun/base64.html</span></span><br><span class="line">  <span class="attr">mongo-username:</span> <span class="string">bW9uZ291c2Vy</span></span><br><span class="line">  <span class="attr">mongo-password:</span> <span class="string">bW9uZ29wYXNz</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åº”ç”¨</span></span><br><span class="line">kubectl apply -f secret.yaml</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹</span></span><br><span class="line">kubectl get secret mongo-secret -o yaml</span><br></pre></td></tr></table></figure>

<h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongodb</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mongo</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">mongo:4.4</span></span><br><span class="line">          <span class="comment"># IfNotPresent ä»…æœ¬åœ°æ²¡æœ‰é•œåƒæ—¶æ‰è¿œç¨‹æ‹‰ï¼ŒAlways æ°¸è¿œéƒ½æ˜¯ä»è¿œç¨‹æ‹‰ï¼ŒNever æ°¸è¿œåªç”¨æœ¬åœ°é•œåƒï¼Œæœ¬åœ°æ²¡æœ‰åˆ™æŠ¥é”™</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="comment"># -------------------- ä»¥ä¸‹æ˜¯æ–°åŠ å…¥çš„éƒ¨åˆ† -------------------------------</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MONGO_INITDB_ROOT_USERNAME</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">secretKeyRef:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">mongo-secret</span></span><br><span class="line">                <span class="attr">key:</span> <span class="string">mongo-username</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MONGO_INITDB_ROOT_PASSWORD</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">secretKeyRef:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">mongo-secret</span></span><br><span class="line">                <span class="attr">key:</span> <span class="string">mongo-password</span></span><br><span class="line">          <span class="comment"># Secret çš„æ‰€æœ‰æ•°æ®å®šä¹‰ä¸ºå®¹å™¨çš„ç¯å¢ƒå˜é‡ï¼ŒSecret ä¸­çš„é”®åç§°ä¸º Pod ä¸­çš„ç¯å¢ƒå˜é‡åç§°</span></span><br><span class="line">          <span class="comment"># envFrom:</span></span><br><span class="line">          <span class="comment"># - secretRef:</span></span><br><span class="line">          <span class="comment">#     name: mongo-secret</span></span><br></pre></td></tr></table></figure>

<h5 id="æŒ‚è½½ä¸ºæ–‡ä»¶ï¼ˆæ›´é€‚åˆè¯ä¹¦æ–‡ä»¶ï¼‰ã€äº†è§£ã€‘"><a href="#æŒ‚è½½ä¸ºæ–‡ä»¶ï¼ˆæ›´é€‚åˆè¯ä¹¦æ–‡ä»¶ï¼‰ã€äº†è§£ã€‘" class="headerlink" title="æŒ‚è½½ä¸ºæ–‡ä»¶ï¼ˆæ›´é€‚åˆè¯ä¹¦æ–‡ä»¶ï¼‰ã€äº†è§£ã€‘"></a>æŒ‚è½½ä¸ºæ–‡ä»¶ï¼ˆæ›´é€‚åˆè¯ä¹¦æ–‡ä»¶ï¼‰ã€äº†è§£ã€‘</h5><p>æŒ‚è½½åï¼Œä¼šåœ¨å®¹å™¨ä¸­å¯¹åº”è·¯å¾„ç”Ÿæˆæ–‡ä»¶ï¼Œä¸€ä¸ª key ä¸€ä¸ªæ–‡ä»¶ï¼Œå†…å®¹å°±æ˜¯ valueï¼Œ<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/configuration/secret/#using-secrets-as-files-from-a-pod">æ–‡æ¡£</a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mypod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mypod</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">foo</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">&quot;/etc/foo&quot;</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">foo</span></span><br><span class="line">    <span class="attr">secret:</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">mysecret</span></span><br></pre></td></tr></table></figure>

<h1 id="Helm-å‘½åç©ºé—´"><a href="#Helm-å‘½åç©ºé—´" class="headerlink" title="Helm &amp; å‘½åç©ºé—´"></a>Helm &amp; å‘½åç©ºé—´</h1><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p><code>Helm</code>ç±»ä¼¼ npmï¼Œpipï¼Œdocker hub, å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªè½¯ä»¶åº“ï¼Œå¯ä»¥æ–¹ä¾¿å¿«é€Ÿçš„ä¸ºé›†ç¾¤å®‰è£…ä¸€äº›ç¬¬ä¸‰æ–¹è½¯ä»¶ã€‚<br>ä½¿ç”¨ <code>Helm</code>å¯ä»¥éå¸¸æ–¹ä¾¿çš„å°±æ­å»ºå‡ºæ¥ <code>MongoDB </code>&#x2F; <code>MySQL </code>å‰¯æœ¬é›†ç¾¤ï¼Œ<code>YAML </code>æ–‡ä»¶åˆ«äººéƒ½ç»™å†™å¥½äº†ï¼Œç›´æ¥ä½¿ç”¨ã€‚<a target="_blank" rel="noopener" href="https://helm.sh/zh/">å®˜ç½‘</a>ï¼Œ<a target="_blank" rel="noopener" href="https://artifacthub.io/">åº”ç”¨ä¸­å¿ƒ</a></p>
<h2 id="å®‰è£…-Helm"><a href="#å®‰è£…-Helm" class="headerlink" title="å®‰è£… Helm"></a>å®‰è£… Helm</h2><p>å®‰è£… <a target="_blank" rel="noopener" href="https://helm.sh/zh/docs/intro/install/">æ–‡æ¡£</a><br><code>curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash</code></p>
<p>æœ¬åœ°æœ‰å®‰è£…åŒ…</p>
<h2 id="Helmå®‰è£…-MongoDB-ç¤ºä¾‹"><a href="#Helmå®‰è£…-MongoDB-ç¤ºä¾‹" class="headerlink" title="Helmå®‰è£… MongoDB ç¤ºä¾‹"></a>Helmå®‰è£… MongoDB ç¤ºä¾‹</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…</span></span><br><span class="line"><span class="comment"># å°† Bitnami çš„ Helm ä»“åº“æ·»åŠ åˆ°æœ¬åœ° Helm é…ç½®ä¸­ï¼Œæ–¹ä¾¿åç»­å®‰è£… MongoDB</span></span><br><span class="line"><span class="string">helm</span> <span class="string">repo</span> <span class="string">add</span> <span class="string">bitnami</span> <span class="string">https://charts.bitnami.com/bitnami</span></span><br><span class="line"><span class="comment"># Helm å®‰è£…ä¸€ä¸ªåä¸º my-mongo çš„ MongoDB é›†ç¾¤ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¼šå®‰è£…ä¸€ä¸ªå•å®ä¾‹ MongoDB</span></span><br><span class="line"><span class="string">helm</span> <span class="string">install</span> <span class="string">my-mongo</span> <span class="string">bitnami/mongodb</span></span><br><span class="line"><span class="comment"># å®‰è£…mysqlï¼ˆå‘½ä»¤è®°å½•ï¼‰</span></span><br><span class="line"><span class="string">helm</span> <span class="string">install</span> <span class="string">my-mysql</span> <span class="string">bitnami/mysql</span> <span class="string">--set</span> <span class="string">architecture=&quot;replication&quot;,auth.rootPassword=&quot;yourpassword&quot;,auth.replicationPassword=&quot;replicapassword&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šå¯†ç å’Œæ¶æ„</span></span><br><span class="line"><span class="comment"># å°† MongoDB éƒ¨ç½²ä¸ºå‰¯æœ¬é›†ï¼ˆreplica setï¼‰æ¶æ„ï¼Œå¹¶è®¾ç½® root ç”¨æˆ·å¯†ç ä¸º mongopass</span></span><br><span class="line"><span class="string">helm</span> <span class="string">install</span> <span class="string">my-mongo</span> <span class="string">bitnami/mongodb</span> <span class="string">--set</span> <span class="string">architecture=&quot;replicaset&quot;,auth.rootPassword=&quot;mongopass&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨ helm ls æŸ¥çœ‹å·²å®‰è£…çš„ Helm å‘è¡Œç‰ˆï¼Œé€šè¿‡ helm delete åˆ é™¤ my-mongo è¿™ä¸ªå®ä¾‹</span></span><br><span class="line"><span class="string">helm</span> <span class="string">ls</span></span><br><span class="line"><span class="string">helm</span> <span class="string">delete</span> <span class="string">my-mongo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¯†ç </span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å­˜å‚¨åœ¨ Kubernetes Secret ä¸­çš„ MongoDB root å¯†ç ï¼Œå¯ä»¥ä»¥ JSON æˆ– YAML æ ¼å¼è¾“å‡ºå¹¶ä¿å­˜</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">get</span> <span class="string">secret</span> <span class="string">my-mongo-mongodb</span> <span class="string">-o</span> <span class="string">json</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">get</span> <span class="string">secret</span> <span class="string">my-mongo-mongodb</span> <span class="string">-o</span> <span class="string">yaml</span> <span class="string">&gt;</span> <span class="string">secret.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸´æ—¶è¿è¡Œä¸€ä¸ªåŒ…å« mongo client çš„ debian ç³»ç»Ÿ</span></span><br><span class="line"><span class="comment"># è¿è¡Œä¸€ä¸ªä¸´æ—¶å®¹å™¨è¿›å…¥ MongoDB å®¢æˆ·ç«¯ç¯å¢ƒï¼Œä½¿ç”¨ bitnami/mongodb é•œåƒæ¥è®¿é—® MongoDB</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">run</span> <span class="string">mongodb-client</span> <span class="string">--rm</span> <span class="string">--tty</span> <span class="string">-i</span> <span class="string">--restart=&#x27;Never&#x27;</span> <span class="string">--image</span> <span class="string">docker.io/bitnami/mongodb:4.4.10-debian-10-r20</span> <span class="string">--command</span> <span class="string">--</span> <span class="string">bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å» mongodb</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨ MongoDB å®¢æˆ·ç«¯ç™»å½•åˆ° MongoDB å®ä¾‹ï¼Œè¿æ¥åœ°å€ä¸º my-mongo-mongodbï¼Œä½¿ç”¨ root ç”¨æˆ·åå’Œå¯†ç </span></span><br><span class="line"><span class="string">mongo</span> <span class="string">--host</span> <span class="string">&quot;my-mongo-mongodb&quot;</span> <span class="string">-u</span> <span class="string">root</span> <span class="string">-p</span> <span class="string">mongopass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥è½¬å‘é›†ç¾¤é‡Œçš„ç«¯å£åˆ°å®¿ä¸»æœºè®¿é—® mongodb</span></span><br><span class="line"><span class="comment"># å°†é›†ç¾¤ä¸­çš„ MongoDB æœåŠ¡ç«¯å£ 27018 è½¬å‘åˆ°æœ¬åœ°ä¸»æœºçš„ 27017ï¼Œä»¥ä¾¿å¯ä»¥åœ¨æœ¬åœ°é€šè¿‡ localhost:27017 è®¿é—® MongoDB</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">port-forward</span> <span class="string">svc/my-mongo-mongodb</span> <span class="number">27017</span><span class="string">:27018</span></span><br></pre></td></tr></table></figure>

<p>å¥½å¤„æ˜¯ï¼Œå¯ä»¥ç›´æ¥å®‰è£…é«˜å¯ç”¨ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ“ä½œ</p>
<h2 id="å‘½åç©ºé—´"><a href="#å‘½åç©ºé—´" class="headerlink" title="å‘½åç©ºé—´"></a>å‘½åç©ºé—´</h2><p>å¦‚æœä¸€ä¸ªé›†ç¾¤ä¸­éƒ¨ç½²äº†å¤šä¸ªåº”ç”¨ï¼Œæ‰€æœ‰åº”ç”¨éƒ½åœ¨ä¸€èµ·ï¼Œå°±ä¸å¤ªå¥½ç®¡ç†ï¼Œä¹Ÿå¯ä»¥å¯¼è‡´åå­—å†²çªç­‰ã€‚<br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>namespace </code>æŠŠåº”ç”¨åˆ’åˆ†åˆ°ä¸åŒçš„å‘½åç©ºé—´ï¼Œè·Ÿä»£ç é‡Œçš„ namespace æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œåªæ˜¯ä¸ºäº†åˆ’åˆ†ç©ºé—´ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºå‘½åç©ºé—´</span></span><br><span class="line">kubectl create namespace testapp</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">éƒ¨ç½²åº”ç”¨åˆ°æŒ‡å®šçš„å‘½åç©ºé—´</span></span><br><span class="line">kubectl apply -f app.yml --namespace testapp</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥è¯¢</span></span><br><span class="line">kubectl get pod --namespace kube-system</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ç”¨ <code>kubens</code>å¿«é€Ÿåˆ‡æ¢ <code>namespace</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ‡æ¢å‘½åç©ºé—´</span></span><br><span class="line">kubens kube-system</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å›åˆ°ä¸Šä¸ªå‘½åç©ºé—´</span></span><br><span class="line">kubens -</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ‡æ¢é›†ç¾¤</span></span><br><span class="line">kubectx minikube</span><br></pre></td></tr></table></figure>



<h1 id="Ingress"><a href="#Ingress" class="headerlink" title="Ingress"></a>Ingress</h1><h2 id="ä»‹ç»-1"><a href="#ä»‹ç»-1" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>Ingress ä¸ºå¤–éƒ¨è®¿é—®é›†ç¾¤æä¾›äº†ä¸€ä¸ª <strong>ç»Ÿä¸€</strong> å…¥å£ï¼Œé¿å…äº†å¯¹å¤–æš´éœ²é›†ç¾¤ç«¯å£ï¼›<br>åŠŸèƒ½ç±»ä¼¼ Nginxï¼Œå¯ä»¥æ ¹æ®åŸŸåã€è·¯å¾„æŠŠè¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„ Serviceã€‚<br>å¯ä»¥é…ç½® https</p>
<h2 id="è·Ÿ-LoadBalancer-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#è·Ÿ-LoadBalancer-æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="è·Ÿ LoadBalancer æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a><strong>è·Ÿ LoadBalancer æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h2><ul>
<li><p><code>LoadBalancer </code>éœ€è¦å¯¹å¤–æš´éœ²ç«¯å£ï¼Œä¸å®‰å…¨</p>
</li>
<li><p>æ— æ³•æ ¹æ®åŸŸåã€è·¯å¾„è½¬å‘æµé‡åˆ°ä¸åŒ <code>Service</code>ï¼Œå¤šä¸ª <code>Service </code>åˆ™éœ€è¦å¼€å¤šä¸ª <code>LoadBalancer</code>ï¼›</p>
</li>
<li><p>åŠŸèƒ½å•ä¸€ï¼Œæ— æ³•é…ç½® <code>https</code></p>
</li>
</ul>
<h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>è¦ä½¿ç”¨ <code>Ingress</code>ï¼Œéœ€è¦ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ + <code>Ingress Controller</code></p>
<p>å¦‚æœæ˜¯è£¸æœºï¼ˆbare metal) æ­å»ºçš„é›†ç¾¤ï¼Œéœ€è¦è‡ªå·±å®‰è£…ä¸€ä¸ªè´Ÿè½½å‡è¡¡æ’ä»¶ï¼Œå¯ä»¥å®‰è£… <a target="_blank" rel="noopener" href="https://metallb.universe.tf/">METALLB</a></p>
<p>å¦‚æœæ˜¯äº‘æœåŠ¡å•†ï¼Œä¼šè‡ªåŠ¨ç»™é…ç½®ï¼Œå¦åˆ™å¤–éƒ¨ IP ä¼šæ˜¯ â€œpendingâ€ çŠ¶æ€ï¼Œæ— æ³•ä½¿ç”¨ã€‚</p>
<p>æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/services-networking/ingress/">Ingress</a></p>
<p>Minikube ä¸­éƒ¨ç½² Ingress Controllerï¼š<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/tasks/access-application-cluster/ingress-minikube/">nginx</a></p>
<p>Helm å®‰è£…ï¼š <a target="_blank" rel="noopener" href="https://kubernetes.github.io/ingress-nginx/deploy/#quick-start">Nginx</a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">simple-example</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">tools.fun</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/easydoc</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">service1</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">4200</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/svnbucket</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">service2</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>

<h1 id="è®­ç»ƒæ–¹æ¡ˆ"><a href="#è®­ç»ƒæ–¹æ¡ˆ" class="headerlink" title="è®­ç»ƒæ–¹æ¡ˆ"></a>è®­ç»ƒæ–¹æ¡ˆ</h1></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/ByteQuestor">ç‹å­é˜³</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://example.com/2024/09/21/%E4%B8%80%E7%AF%87%E5%AD%A6%E4%B9%A0k8s%E7%9A%84%E8%AE%B0%E5%BD%95/">http://example.com/2024/09/21/%E4%B8%80%E7%AF%87%E5%AD%A6%E4%B9%A0k8s%E7%9A%84%E8%AE%B0%E5%BD%95/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="http://example.com" target="_blank">ç‹å­é˜³ã®ä¸»é¡µ</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/k8s/">k8s</a></div><div class="post-share"><div class="social-share" data-image="https://raw.gitmirror.com/ByteQuestor/picture/main/kubernetes/k8s.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>èµåŠ©</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://raw.gitmirror.com/ByteQuestor/picture/main/paywx.png" target="_blank"><img class="post-qr-code-img" src="https://raw.gitmirror.com/ByteQuestor/picture/main/paywx.png" alt="å¾®ä¿¡æŠ•å–‚"/></a><div class="post-qr-code-desc">å¾®ä¿¡æŠ•å–‚</div></li><li class="reward-item"><a href="https://raw.gitmirror.com/ByteQuestor/picture/main/zfbbpay.png" target="_blank"><img class="post-qr-code-img" src="https://raw.gitmirror.com/ByteQuestor/picture/main/zfbbpay.png" alt="æ”¯ä»˜å®æŠ•å–‚"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®æŠ•å–‚</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="prev-post pull-left" href="/2024/09/29/Hexo%E9%85%8D%E5%90%88GithubAction%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/" title="Hexoé…åˆGithubActionè‡ªåŠ¨åŒ–éƒ¨ç½²ä¸ªäººåšå®¢"><img class="cover" src="https://raw.gitmirror.com/ByteQuestor/picture/main/GitHub-Logo.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Hexoé…åˆGithubActionè‡ªåŠ¨åŒ–éƒ¨ç½²ä¸ªäººåšå®¢</div></div></a><a class="next-post pull-right" href="/2024/09/19/%E5%9C%A8%E8%85%BE%E8%AE%AF%E4%BA%91%E4%B8%8A%E9%83%A8%E7%BD%B2todo%E5%B9%B6%E9%85%8D%E7%BD%AE%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/" title="åœ¨è…¾è®¯äº‘ä¸Šéƒ¨ç½²todoå¹¶é…ç½®è´Ÿè½½å‡è¡¡"><img class="cover" src="https://raw.gitmirror.com/ByteQuestor/picture/main/tencent/tencent.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">åœ¨è…¾è®¯äº‘ä¸Šéƒ¨ç½²todoå¹¶é…ç½®è´Ÿè½½å‡è¡¡</div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a href="/2024/10/02/%E5%9C%A8Centos7-9%E4%B8%8A%E6%89%8B%E5%B7%A5%E9%83%A8%E7%BD%B2k8s/" title="åœ¨Centos7.9ä¸Šæ‰‹å·¥éƒ¨ç½²k8s"><img class="cover" src="https://raw.gitmirror.com/ByteQuestor/picture/main/k8s130.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-02</div><div class="title">åœ¨Centos7.9ä¸Šæ‰‹å·¥éƒ¨ç½²k8s</div></div></a><a href="/2024/09/17/%E5%9C%A8k8s%E4%B8%8A%E5%AF%B9WeatherForecast%E8%BF%9B%E8%A1%8CAB%E6%B5%8B%E8%AF%95/" title="åœ¨k8sä¸Šå¯¹WeatherForecastè¿›è¡ŒABæµ‹è¯•"><img class="cover" src="https://raw.gitmirror.com/ByteQuestor/picture/main/WeatherForecast.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-17</div><div class="title">åœ¨k8sä¸Šå¯¹WeatherForecastè¿›è¡ŒABæµ‹è¯•</div></div></a><a href="/2024/09/17/%E5%9C%A8k8s%E4%B8%8A%E5%AF%B9WeatherForecast%E8%BF%9B%E8%A1%8C%E5%A4%9A%E6%9C%8D%E5%8A%A1%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/" title="åœ¨k8sä¸Šå¯¹WeatherForecastè¿›è¡Œå¤šæœåŠ¡ç°åº¦å‘å¸ƒ"><img class="cover" src="https://raw.gitmirror.com/ByteQuestor/picture/main/WeatherForecast.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-17</div><div class="title">åœ¨k8sä¸Šå¯¹WeatherForecastè¿›è¡Œå¤šæœåŠ¡ç°åº¦å‘å¸ƒ</div></div></a><a href="/2024/09/17/%E5%9C%A8k8s%E4%B8%8A%E5%AF%B9WeatherForecast%E8%BF%9B%E8%A1%8C%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83/" title="åœ¨k8sä¸Šå¯¹WeatherForecastè¿›è¡Œç°åº¦å‘å¸ƒ"><img class="cover" src="https://raw.gitmirror.com/ByteQuestor/picture/main/WeatherForecast.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-17</div><div class="title">åœ¨k8sä¸Šå¯¹WeatherForecastè¿›è¡Œç°åº¦å‘å¸ƒ</div></div></a><a href="/2024/09/16/%E5%9C%A8k8s%E4%B8%8A%E9%83%A8%E7%BD%B2WeatherForecast/" title="åœ¨k8sä¸Šéƒ¨ç½²WeatherForecast"><img class="cover" src="https://raw.gitmirror.com/ByteQuestor/picture/main/WeatherForecast.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-16</div><div class="title">åœ¨k8sä¸Šéƒ¨ç½²WeatherForecast</div></div></a><a href="/2024/11/03/%E8%AE%B0%E5%BD%95k8s%E5%88%A0%E9%99%A4%E6%B1%A1%E7%82%B9/" title="k8sé›†ç¾¤åˆ é™¤æ±¡ç‚¹"><img class="cover" src="https://raw.gitmirror.com/ByteQuestor/picture/main/kubernetes/k8s.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-03</div><div class="title">k8sé›†ç¾¤åˆ é™¤æ±¡ç‚¹</div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info is-center"><div class="avatar-img"><img src="https://raw.gitmirror.com//ByteQuestor/picture/main/myhead.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">ç‹å­é˜³</div><div class="author-info-description">å¤©åœ°æœ¬æ— å…¨</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">24</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ByteQuestor"><i class="fab fa-github"></i><span>Github</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">ä¸€å®šæ˜¯å¹³æ—¶ç»ƒä¹ æ€»æ˜¯ å·®ä¸å¤š å·®ä¸å¤š å…³é”®æ—¶åˆ»æ€»æ˜¯å·®ä¸€ç‚¹</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#k8s%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">k8sç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8%E7%9A%84%E6%96%B9%E6%A1%88"><span class="toc-number">1.1.</span> <span class="toc-text">éƒ¨ç½²åº”ç”¨çš„æ–¹æ¡ˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E9%9C%80%E8%A6%81k8s"><span class="toc-number">1.2.</span> <span class="toc-text">ä»€ä¹ˆæ—¶å€™éœ€è¦k8s</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#k8s%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84"><span class="toc-number">1.3.</span> <span class="toc-text">k8sé›†ç¾¤æ¶æ„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5Pod%EF%BC%88%E8%B1%86%E8%8D%9A%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">é‡è¦æ¦‚å¿µPodï¼ˆè±†èšï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#k8s%E7%BB%84%E4%BB%B6"><span class="toc-number">1.5.</span> <span class="toc-text">k8sç»„ä»¶</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4"><span class="toc-number">2.</span> <span class="toc-text">å®‰è£…k8sé›†ç¾¤</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E5%90%8D%E6%98%A0%E5%B0%84"><span class="toc-number">2.1.</span> <span class="toc-text">ä¸»æœºåæ˜ å°„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%97%ADSElinux-%E9%98%B2%E6%8A%A4%E5%A2%99"><span class="toc-number">2.2.</span> <span class="toc-text">å…³é—­SElinux &amp; é˜²æŠ¤å¢™</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%AE%89%E8%A3%85%E6%BA%90"><span class="toc-number">2.3.</span> <span class="toc-text">æ·»åŠ å®‰è£…æº</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%89%80%E9%9C%80%E7%BB%84%E4%BB%B6%EF%BC%88%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%EF%BC%89"><span class="toc-number">2.4.</span> <span class="toc-text">å®‰è£…æ‰€éœ€ç»„ä»¶ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8-kubelet%E3%80%81docker%EF%BC%8C%E5%B9%B6%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8%EF%BC%88%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%EF%BC%89"><span class="toc-number">2.5.</span> <span class="toc-text">å¯åŠ¨ kubeletã€dockerï¼Œå¹¶è®¾ç½®å¼€æœºå¯åŠ¨ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9-docker-%E9%85%8D%E7%BD%AE%EF%BC%88%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%EF%BC%89"><span class="toc-number">2.6.</span> <span class="toc-text">ä¿®æ”¹ docker é…ç½®ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8-kubeadm-%E5%88%9D%E5%A7%8B%E5%8C%96%E9%9B%86%E7%BE%A4%EF%BC%88%E4%BB%85%E5%9C%A8%E4%B8%BB%E8%8A%82%E7%82%B9%E8%B7%91%EF%BC%89"><span class="toc-number">2.7.</span> <span class="toc-text">ç”¨ kubeadm åˆå§‹åŒ–é›†ç¾¤ï¼ˆä»…åœ¨ä¸»èŠ‚ç‚¹è·‘ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%8A%E5%B7%A5%E4%BD%9C%E8%8A%82%E7%82%B9%E5%8A%A0%E5%85%A5%E9%9B%86%E7%BE%A4%EF%BC%88%E5%8F%AA%E5%9C%A8%E5%B7%A5%E4%BD%9C%E8%8A%82%E7%82%B9%E8%B7%91%EF%BC%89"><span class="toc-number">2.8.</span> <span class="toc-text">æŠŠå·¥ä½œèŠ‚ç‚¹åŠ å…¥é›†ç¾¤ï¼ˆåªåœ¨å·¥ä½œèŠ‚ç‚¹è·‘ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%EF%BC%8C%E5%90%A6%E5%88%99-node-%E6%98%AF-NotReady-%E7%8A%B6%E6%80%81%EF%BC%88%E4%B8%BB%E8%8A%82%E7%82%B9%E8%B7%91%EF%BC%89"><span class="toc-number">2.9.</span> <span class="toc-text">å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œå¦åˆ™ node æ˜¯ NotReady çŠ¶æ€ï¼ˆä¸»èŠ‚ç‚¹è·‘ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8%E5%88%B0%E9%9B%86%E7%BE%A4%E4%B8%AD"><span class="toc-number">3.</span> <span class="toc-text">éƒ¨ç½²åº”ç”¨åˆ°é›†ç¾¤ä¸­</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E9%83%A8%E7%BD%B2"><span class="toc-number">3.1.</span> <span class="toc-text">ç®€å•éƒ¨ç½²</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pod"><span class="toc-number">3.2.</span> <span class="toc-text">Pod</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Deployment"><span class="toc-number">3.3.</span> <span class="toc-text">Deployment</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%A5%BD%E7%94%A8%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">3.4.</span> <span class="toc-text">ä¸€äº›å¥½ç”¨çš„å‘½ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%B0%83%E5%BA%A6pod"><span class="toc-number">3.4.1.</span> <span class="toc-text">å‘½ä»¤è¡Œè°ƒåº¦pod</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%BB%91%E5%AE%9A%E7%AB%AF%E5%8F%A3"><span class="toc-number">3.4.2.</span> <span class="toc-text">å‘½ä»¤è¡Œç»‘å®šç«¯å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BF%AE%E6%94%B9%E9%95%9C%E5%83%8F"><span class="toc-number">3.4.3.</span> <span class="toc-text">å‘½ä»¤è¡Œä¿®æ”¹é•œåƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9E%E6%BB%9A%E6%93%8D%E4%BD%9C"><span class="toc-number">3.4.4.</span> <span class="toc-text">å›æ»šæ“ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9A%82%E5%81%9C%E5%92%8C%E6%81%A2%E5%A4%8D%E3%80%90%E5%86%B7%E9%97%A8%E3%80%91"><span class="toc-number">3.4.5.</span> <span class="toc-text">æš‚åœå’Œæ¢å¤ã€å†·é—¨ã€‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E5%88%B0%E6%96%87%E4%BB%B6%E3%80%90%E5%86%B7%E9%97%A8%E3%80%91"><span class="toc-number">3.4.6.</span> <span class="toc-text">è¾“å‡ºåˆ°æ–‡ä»¶ã€å†·é—¨ã€‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%85%A8%E9%83%A8%E8%B5%84%E6%BA%90%E3%80%90%E5%86%B7%E9%97%A8%E3%80%91"><span class="toc-number">3.4.7.</span> <span class="toc-text">åˆ é™¤å…¨éƒ¨èµ„æºã€å†·é—¨ã€‘</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#YAML%E6%8C%87%E5%AE%9A%E6%9F%90%E4%B8%AA%E8%8A%82%E7%82%B9%E8%BF%90%E8%A1%8C"><span class="toc-number">3.5.</span> <span class="toc-text">YAMLæŒ‡å®šæŸä¸ªèŠ‚ç‚¹è¿è¡Œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E8%8A%82%E9%A2%84%E5%91%8A"><span class="toc-number">3.6.</span> <span class="toc-text">ä¸‹èŠ‚é¢„å‘Š</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD%E5%88%86%E7%B1%BB%E3%80%90%E4%BA%86%E8%A7%A3%E3%80%91"><span class="toc-number">3.6.1.</span> <span class="toc-text">å·¥ä½œè´Ÿè½½åˆ†ç±»ã€äº†è§£ã€‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%B0%E5%AD%98%E9%97%AE%E9%A2%98"><span class="toc-number">3.6.2.</span> <span class="toc-text">ç°å­˜é—®é¢˜</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Service"><span class="toc-number">4.</span> <span class="toc-text">Service</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%80%A7"><span class="toc-number">4.1.</span> <span class="toc-text">ç‰¹æ€§</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAService"><span class="toc-number">4.2.</span> <span class="toc-text">åˆ›å»ºService</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E5%A4%96%E6%9A%B4%E9%9C%B2%E6%9C%8D%E5%8A%A1-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">4.2.1.</span> <span class="toc-text">å¯¹å¤–æš´éœ²æœåŠ¡ &amp; è´Ÿè½½å‡è¡¡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%AB%AF%E5%8F%A3"><span class="toc-number">4.3.</span> <span class="toc-text">å¤šç«¯å£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E8%8A%82%E5%86%85%E5%AE%B9"><span class="toc-number">4.4.</span> <span class="toc-text">æœ¬èŠ‚å†…å®¹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ClusterIP"><span class="toc-number">4.4.1.</span> <span class="toc-text">ClusterIP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NodePort"><span class="toc-number">4.4.2.</span> <span class="toc-text">NodePort</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LoadBalancer"><span class="toc-number">4.4.3.</span> <span class="toc-text">LoadBalancer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Headless"><span class="toc-number">4.4.4.</span> <span class="toc-text">Headless</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#StatefuSet"><span class="toc-number">5.</span> <span class="toc-text">StatefuSet</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFStatefuSet"><span class="toc-number">5.1.</span> <span class="toc-text">ä»€ä¹ˆæ˜¯StatefuSet</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#StatefulSet-%E7%89%B9%E6%80%A7"><span class="toc-number">5.2.</span> <span class="toc-text">StatefulSet ç‰¹æ€§</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2-StatefulSet-%E7%B1%BB%E5%9E%8B%E7%9A%84-Mongodb"><span class="toc-number">5.3.</span> <span class="toc-text">éƒ¨ç½² StatefulSet ç±»å‹çš„ Mongodb</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Web-%E5%BA%94%E7%94%A8%E8%BF%9E%E6%8E%A5-Mongodb"><span class="toc-number">5.3.1.</span> <span class="toc-text">Web åº”ç”¨è¿æ¥ Mongodb</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">5.4.</span> <span class="toc-text">é—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">6.</span> <span class="toc-text">æ•°æ®æŒä¹…åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">6.1.</span> <span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hostPath-%E6%8C%82%E8%BD%BD"><span class="toc-number">6.2.</span> <span class="toc-text">hostPath æŒ‚è½½</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E4%BB%8B%E7%BB%8D"><span class="toc-number">6.3.</span> <span class="toc-text">å­˜å‚¨ä»‹ç»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Persistent-Volume-Claim-PVC"><span class="toc-number">6.3.1.</span> <span class="toc-text">Persistent Volume Claim (PVC)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Persistent-Volume-PV"><span class="toc-number">6.3.2.</span> <span class="toc-text">Persistent Volume (PV)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Storage-Class-SC"><span class="toc-number">6.3.3.</span> <span class="toc-text">Storage Class (SC)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8"><span class="toc-number">6.4.</span> <span class="toc-text">æœ¬åœ°å­˜å‚¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98-1"><span class="toc-number">6.5.</span> <span class="toc-text">é—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ConfigMap-Secret"><span class="toc-number">7.</span> <span class="toc-text">ConfigMap &amp; Secret</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ConfigMap"><span class="toc-number">7.1.</span> <span class="toc-text">ConfigMap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Secret"><span class="toc-number">7.2.</span> <span class="toc-text">Secret</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">7.3.</span> <span class="toc-text">ä½¿ç”¨æ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8C%82%E8%BD%BD%E4%B8%BA%E6%96%87%E4%BB%B6%EF%BC%88%E6%9B%B4%E9%80%82%E5%90%88%E8%AF%81%E4%B9%A6%E6%96%87%E4%BB%B6%EF%BC%89%E3%80%90%E4%BA%86%E8%A7%A3%E3%80%91"><span class="toc-number">7.3.0.0.1.</span> <span class="toc-text">æŒ‚è½½ä¸ºæ–‡ä»¶ï¼ˆæ›´é€‚åˆè¯ä¹¦æ–‡ä»¶ï¼‰ã€äº†è§£ã€‘</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Helm-%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-number">8.</span> <span class="toc-text">Helm &amp; å‘½åç©ºé—´</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">8.1.</span> <span class="toc-text">ä»‹ç»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-Helm"><span class="toc-number">8.2.</span> <span class="toc-text">å®‰è£… Helm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Helm%E5%AE%89%E8%A3%85-MongoDB-%E7%A4%BA%E4%BE%8B"><span class="toc-number">8.3.</span> <span class="toc-text">Helmå®‰è£… MongoDB ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-number">8.4.</span> <span class="toc-text">å‘½åç©ºé—´</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Ingress"><span class="toc-number">9.</span> <span class="toc-text">Ingress</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">9.1.</span> <span class="toc-text">ä»‹ç»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%9F-LoadBalancer-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-number">9.2.</span> <span class="toc-text">è·Ÿ LoadBalancer æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">9.3.</span> <span class="toc-text">ä½¿ç”¨</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AE%AD%E7%BB%83%E6%96%B9%E6%A1%88"><span class="toc-number">10.</span> <span class="toc-text">è®­ç»ƒæ–¹æ¡ˆ</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/11/13/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1nginx%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/" title="è®°å½•ä¸€æ¬¡nginxé‡åˆ°çš„é—®é¢˜"><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/nginx/nginx.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="è®°å½•ä¸€æ¬¡nginxé‡åˆ°çš„é—®é¢˜"/></a><div class="content"><a class="title" href="/2024/11/13/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1nginx%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/" title="è®°å½•ä¸€æ¬¡nginxé‡åˆ°çš„é—®é¢˜">è®°å½•ä¸€æ¬¡nginxé‡åˆ°çš„é—®é¢˜</a><time datetime="2024-11-13T11:34:49.000Z" title="å‘è¡¨äº 2024-11-13 11:34:49">2024-11-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/09/%E8%AE%B0%E5%BD%95k8s%E5%BC%80%E5%8F%91%E8%BF%90%E7%BB%B4%E7%9A%84%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/" title="è®°å½•k8så¼€å‘è¿ç»´çš„ç¯å¢ƒå‡†å¤‡"><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/kubernetes/k8s.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="è®°å½•k8så¼€å‘è¿ç»´çš„ç¯å¢ƒå‡†å¤‡"/></a><div class="content"><a class="title" href="/2024/11/09/%E8%AE%B0%E5%BD%95k8s%E5%BC%80%E5%8F%91%E8%BF%90%E7%BB%B4%E7%9A%84%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/" title="è®°å½•k8så¼€å‘è¿ç»´çš„ç¯å¢ƒå‡†å¤‡">è®°å½•k8så¼€å‘è¿ç»´çš„ç¯å¢ƒå‡†å¤‡</a><time datetime="2024-11-09T18:12:57.000Z" title="å‘è¡¨äº 2024-11-09 18:12:57">2024-11-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/07/%E8%AE%B0%E5%BD%95%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8github%E5%88%9B%E5%BB%BArelease/" title="è®°å½•å¦‚ä½•ä½¿ç”¨githubåˆ›å»ºrelease"><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/GitHub-Logo.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="è®°å½•å¦‚ä½•ä½¿ç”¨githubåˆ›å»ºrelease"/></a><div class="content"><a class="title" href="/2024/11/07/%E8%AE%B0%E5%BD%95%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8github%E5%88%9B%E5%BB%BArelease/" title="è®°å½•å¦‚ä½•ä½¿ç”¨githubåˆ›å»ºrelease">è®°å½•å¦‚ä½•ä½¿ç”¨githubåˆ›å»ºrelease</a><time datetime="2024-11-07T09:17:38.000Z" title="å‘è¡¨äº 2024-11-07 09:17:38">2024-11-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/03/%E8%AE%B0%E5%BD%95k8s%E5%88%A0%E9%99%A4%E6%B1%A1%E7%82%B9/" title="k8sé›†ç¾¤åˆ é™¤æ±¡ç‚¹"><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/kubernetes/k8s.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="k8sé›†ç¾¤åˆ é™¤æ±¡ç‚¹"/></a><div class="content"><a class="title" href="/2024/11/03/%E8%AE%B0%E5%BD%95k8s%E5%88%A0%E9%99%A4%E6%B1%A1%E7%82%B9/" title="k8sé›†ç¾¤åˆ é™¤æ±¡ç‚¹">k8sé›†ç¾¤åˆ é™¤æ±¡ç‚¹</a><time datetime="2024-11-03T15:14:37.000Z" title="å‘è¡¨äº 2024-11-03 15:14:37">2024-11-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/25/%E8%AE%B0%E5%BD%95%E5%B8%B8%E7%94%A8%E7%9A%84Markdown%E8%AF%AD%E5%8F%A5/" title="è®°å½•å¸¸ç”¨çš„Markdownè¯­å¥"><img src="https://raw.gitmirror.com/ByteQuestor/picture/main/markdown.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="è®°å½•å¸¸ç”¨çš„Markdownè¯­å¥"/></a><div class="content"><a class="title" href="/2024/10/25/%E8%AE%B0%E5%BD%95%E5%B8%B8%E7%94%A8%E7%9A%84Markdown%E8%AF%AD%E5%8F%A5/" title="è®°å½•å¸¸ç”¨çš„Markdownè¯­å¥">è®°å½•å¸¸ç”¨çš„Markdownè¯­å¥</a><time datetime="2024-10-25T17:34:17.000Z" title="å‘è¡¨äº 2024-10-25 17:34:17">2024-10-25</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By ç‹å­é˜³</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.0.0-b2"></script><script src="/js/main.js?v=5.0.0-b2"></script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU" data-fontsize="25px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>